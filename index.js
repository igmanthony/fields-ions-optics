!function(e){function t(t){for(var n,r,l=t[0],a=t[1],i=0,c=[];i<l.length;i++)r=l[i],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&c.push(o[r][0]),o[r]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(s&&s(t);c.length;)c.shift()()}var n={},o={0:0};var r={};var l={2:function(){return{"./index_bg.js":{__wbindgen_throw:function(e,t){return n[1].exports.b(e,t)}}}}};function a(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.e=function(e){var t=[],n=o[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise((function(t,r){n=o[e]=[t,r]}));t.push(n[2]=i);var c,d=document.createElement("script");d.charset="utf-8",d.timeout=120,a.nc&&d.setAttribute("nonce",a.nc),d.src=function(e){return a.p+""+({}[e]||e)+".js"}(e);var s=new Error;c=function(t){d.onerror=d.onload=null,clearTimeout(f);var n=o[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),l=t&&t.target&&t.target.src;s.message="Loading chunk "+e+" failed.\n("+r+": "+l+")",s.name="ChunkLoadError",s.type=r,s.request=l,n[1](s)}o[e]=void 0}};var f=setTimeout((function(){c({type:"timeout",target:d})}),12e4);d.onerror=d.onload=c,document.head.appendChild(d)}return({1:[2]}[e]||[]).forEach((function(e){var n=r[e];if(n)t.push(n);else{var o,i=l[e](),c=fetch(a.p+""+{2:"3dc26956ab8cffdf7e16"}[e]+".module.wasm");if(i instanceof Promise&&"function"==typeof WebAssembly.compileStreaming)o=Promise.all([WebAssembly.compileStreaming(c),i]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"==typeof WebAssembly.instantiateStreaming)o=WebAssembly.instantiateStreaming(c,i);else{o=c.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,i)}))}t.push(r[e]=o.then((function(t){return a.w[e]=(t.instance||t).exports})))}})),Promise.all(t)},a.m=e,a.c=n,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a.oe=function(e){throw console.error(e),e},a.w={};var i=window.webpackJsonp=window.webpackJsonp||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var d=0;d<i.length;d++)t(i[d]);var s=c;a(a.s=0)}([function(e,t,n){"use strict";n.r(t);const o=["#ffffff","#f44336","#4CAF50","#2196F3","#795548"],r=["#ffffff","#FFCDD2","#C8E6C9","#BBDEFB","#D7CCC8"],l=["#ffffff","#E57373","#81C784","#64B5F6","#A1887F"],a=[-1,0,0,0,0],i=[!0,!0,!0,!0,!0],c=[0,100,100,100,100],d=[0,0,0,0,0],s=[0,70,100,1,-1],f=[0,1e3,-500,0,1020],u=[-1,0,0,1,0],m=[0,40,1,-40,1],_=[0,110,110,110,110],p=[0,10,0,10,0],g=[0,153.55994,0,153.55994,0],y=[0,0,1,0,0],h=[0,150,350,-150,-400],b=[0,70,70,70,70],v=[!0,!1,!0,!1,!0];var E={electrode_volts:[0,500,1e3,-500,-1e3],splattable:[-1,0,0,0,0],electrode_frequencies:[0,1600,1600,1600,1600],electrode_offsets:[0,0,0,0,0],pulse_starts:[0,0,0,0,0],pulse_ends:[0,4e5,4e5,4e5,4e5],active_electrode:1,emap_altered:!1,dragging:!1,dragging_frame:0,initial_click:[-1,-1],brush:1,cmap:["#30123b","#311542","#32184a","#341b51","#351e58","#36215f","#372365","#38266c","#392972","#3a2c79","#3b2f7f","#3c3285","#3c358b","#3d3791","#3e3a96","#3f3d9c","#4040a1","#4043a6","#4145ab","#4148b0","#424bb5","#434eba","#4350be","#4353c2","#4456c7","#4458cb","#455bce","#455ed2","#4560d6","#4563d9","#4666dd","#4668e0","#466be3","#466de6","#4670e8","#4673eb","#4675ed","#4678f0","#467af2","#467df4","#467ff6","#4682f8","#4584f9","#4587fb","#4589fc","#448cfd","#438efd","#4291fe","#4193fe","#4096fe","#3f98fe","#3e9bfe","#3c9dfd","#3ba0fc","#39a2fc","#38a5fb","#36a8f9","#34aaf8","#33acf6","#31aff5","#2fb1f3","#2db4f1","#2bb6ef","#2ab9ed","#28bbeb","#26bde9","#25c0e6","#23c2e4","#21c4e1","#20c6df","#1ec9dc","#1dcbda","#1ccdd7","#1bcfd4","#1ad1d2","#19d3cf","#18d5cc","#18d7ca","#17d9c7","#17dac4","#17dcc2","#17debf","#18e0bd","#18e1ba","#19e3b8","#1ae4b6","#1be5b4","#1de7b1","#1ee8af","#20e9ac","#22eba9","#24eca6","#27eda3","#29eea0","#2cef9d","#2ff09a","#32f197","#35f394","#38f491","#3bf48d","#3ff58a","#42f687","#46f783","#4af880","#4df97c","#51f979","#55fa76","#59fb72","#5dfb6f","#61fc6c","#65fc68","#69fd65","#6dfd62","#71fd5f","#74fe5c","#78fe59","#7cfe56","#80fe53","#84fe50","#87fe4d","#8bfe4b","#8efe48","#92fe46","#95fe44","#98fe42","#9bfd40","#9efd3e","#a1fc3d","#a4fc3b","#a6fb3a","#a9fb39","#acfa37","#aef937","#b1f836","#b3f835","#b6f735","#b9f534","#bbf434","#bef334","#c0f233","#c3f133","#c5ef33","#c8ee33","#caed33","#cdeb34","#cfea34","#d1e834","#d4e735","#d6e535","#d8e335","#dae236","#dde036","#dfde36","#e1dc37","#e3da37","#e5d838","#e7d738","#e8d538","#ead339","#ecd139","#edcf39","#efcd39","#f0cb3a","#f2c83a","#f3c63a","#f4c43a","#f6c23a","#f7c039","#f8be39","#f9bc39","#f9ba38","#fab737","#fbb537","#fbb336","#fcb035","#fcae34","#fdab33","#fda932","#fda631","#fda330","#fea12f","#fe9e2e","#fe9b2d","#fe982c","#fd952b","#fd9229","#fd8f28","#fd8c27","#fc8926","#fc8624","#fb8323","#fb8022","#fa7d20","#fa7a1f","#f9771e","#f8741c","#f7711b","#f76e1a","#f66b18","#f56817","#f46516","#f36315","#f26014","#f15d13","#ef5a11","#ee5810","#ed550f","#ec520e","#ea500d","#e94d0d","#e84b0c","#e6490b","#e5460a","#e3440a","#e24209","#e04008","#de3e08","#dd3c07","#db3a07","#d93806","#d73606","#d63405","#d43205","#d23005","#d02f04","#ce2d04","#cb2b03","#c92903","#c72803","#c52602","#c32402","#c02302","#be2102","#bb1f01","#b91e01","#b61c01","#b41b01","#b11901","#ae1801","#ac1601","#a91501","#a61401","#a31201","#a01101","#9d1001","#9a0e01","#970d01","#940c01","#910b01","#8e0a01","#8b0901","#870801","#840701","#810602","#7d0502","#7a0402"],electric_fields_calculated:!1,voltages_were_updated:!1,latest_ion_path:[],latest_ion:[],current_mz:100,current_x_position:0,current_y_position:0,current_x_velocity:0,current_y_velocity:0,mouse_on_electrode_map:!1,previous_mouse_electrode_position_x:-1,previous_mouse_electrode_position_y:-1,previous_mouse_electrode_position_x2:-1,previous_mouse_electrode_position_y2:-1,mouse_electrode_map_x:0,mouse_electrode_map_y:0,mouse_ef_map_x:0,mouse_ef_map_y:0,delta_ef_map_x:0,delta_ef_map_y:0,no_lines:!0,splatlog:[],dc_only:[1,1,1,1,1],magnet_mode:[0,0,0,0,0],to_apply:[],rect:[0,0],pressure:0,background_gas_mass:4,cellSize:3,scale:2,map_width:200,map_height:200,max_time:4e5,canvas_width:600,canvas_height:600,history1:0,history2:0,history3:Array(1e4).fill(0),random_ke:0,three_dimension_view:0,gl:null,programInfo:null,bufferInfo:null,efmap_altered:0,three_d_zoom_level:0,efmap_pixels:null,fake_canvas:null,refresh_canvas:1};function B(e){const t=e.scale(),n=e.width()/t,l=e.height()/t,a=E.cellSize*t,i=e.electrode_pixels();const c=document.getElementById("electrode_map").getContext("2d");for(let e=0;e<n;e++)for(let t=0;t<l;t++){const l=i[t*n+e];if(1==E.magnet_mode[l]&&l>0){if(c.fillStyle=r[l],c.fillRect(e*a,t*a,a,a),e%3==0&&t%3==0)if(c.fillStyle=o[l],E.electrode_volts[l]>0)for(let n=0;n<a;n++)c.fillRect(e*a+n,t*a+n,1,1),c.fillRect(e*a-n+(a-1),t*a+n,1,1);else c.fillRect(e*a+2,t*a+2,2,2)}else 1==E.splattable[l]&&l>0?(c.fillStyle=o[0],c.fillRect(e*a,t*a,a,a),c.fillStyle=r[l],c.fillRect(e*a+2,t*a+2,2,2)):(c.fillStyle=o[l],c.fillRect(e*a,t*a,a,a))}}function I(e,t,n,o){let r=[],l=n-e,a=o-t,i=Math.max(Math.abs(l),Math.abs(a));for(let l=0;l<=i;l++){let a=0===i?0:l/i,c=e+a*(n-e),d=t+a*(o-t);r.push([Math.round(c),Math.round(d)])}return r}function x(e,t,n,o){let r=I(e,t,n,t),l=I(e,o,n,o);return[...r,...I(e,t,e,o),...I(n,t,n,o),...l]}function k(e,t,n,o){let r=Math.abs(e-n)+e,l=Math.abs(t-o)+t,a=(Math.abs(e-n),Math.abs(t-o),Math.abs(r-e)),i=Math.abs(l-t),c=[];for(let n=t-l;n<t+l;n++){for(let o=e-r;o<e+r;o++)(o-e)*(o-e)/(a*a)+(n-t)*(n-t)/(i*i)<=1&&(o-e)*(o-e)/((a-1)*(a-1))+(n-t)*(n-t)/((i-1)*(i-1))>1&&c.push([Math.round(o),Math.round(n)])}return c}function S(e){E.history1=E.history2,E.history2=E.history3,E.history3=e.electrode_pixels()}function w(e,t){if(E.dragging)E.to_apply.push([E.mouse_electrode_map_x,E.mouse_electrode_map_y]);else if("click"==e.type){E.no_lines=!0;const e=document.getElementById("electrode_map").getBoundingClientRect();let n=E.mouse_electrode_map_x-e.left,o=E.mouse_electrode_map_y-e.top;if(E.emap_altered=!0,n=Math.floor(n/(2*E.cellSize)),o=Math.floor(o/(2*E.cellSize)),n<0||o<0)return;if(1==E.brush)E.previous_mouse_electrode_position_x==n&&E.previous_mouse_electrode_position_y==o||(t.brush(n,o,E.active_electrode),E.previous_mouse_electrode_position_x=n,E.previous_mouse_electrode_position_y=o);else if(2!=E.brush||E.dragging)if(3!=E.brush||E.dragging)if(4!=E.brush||E.dragging){if(5==E.brush&&!E.dragging){const e=t.scale(),r=t.width()/e,l=t.height()/e;let a=function(e,t,n,o,r){let l=[],a=n[t*o+e],i=[];for(i.push([e,t]);0!=i.length;){let e=i.pop(),t=e[1],c=e[0];if(n[t*o+c]==a){l.push(t*o+c);for(let e of[[c+1,t],[c-1,t],[c,t+1],[c,t-1]])0<=e[0]&&e[0]<=o-1&&0<=e[1]&&e[1]<=r-1&&(l.includes(e[1]*o+e[0])||i.push(e))}}return l}(n,o,t.electrode_pixels(),r,l);for(let e of a)t.brush(e%r,Math.floor(e/r),E.active_electrode)}}else{let e=x(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),n,o);for(let n of e)t.brush(n[0],n[1],E.active_electrode)}else{let e=k(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),n,o);for(let n of e)t.brush(n[0],n[1],E.active_electrode)}else{let e=I(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),n,o);for(let n of e)t.brush(n[0],n[1],E.active_electrode)}S(t)}}function A(e){electrode_map.addEventListener("mousedown",e=>{E.emap_altered=!0,E.dragging=!0}),electrode_map.addEventListener("mouseup",t=>{if(E.emap_altered=!0,E.dragging=!1,1==E.brush){const t=electrode_map.getBoundingClientRect();for(let n of E.to_apply){let o=n[0]-t.left,r=n[1]-t.top;o=Math.round(o/(2*E.cellSize)),r=Math.round(r/(2*E.cellSize)),e.brush(o,r,E.active_electrode)}E.to_apply=[]}}),electrode_map.addEventListener("click",t=>{if(1==E.brush||5==E.brush)w(t,e);else if(-1==E.initial_click[0]&&-1==E.initial_click[1]){const e=electrode_map.getBoundingClientRect();E.initial_click[0]=t.clientX-e.left,E.initial_click[1]=t.clientY-e.top}else w(t,e),E.initial_click[0]=-1,E.initial_click[1]=-1}),electrode_map.addEventListener("mousemove",t=>{const n=electrode_map.getBoundingClientRect(),r=E.cellSize*E.scale;E.rect=[n.left,n.top];let l=Math.floor((t.clientX-n.left)/E.cellSize),a=e.height()-Math.floor((t.clientY-n.top)/E.cellSize)-1;if(document.getElementById("status").innerHTML=`x: ${l} y: ${a}`,E.mouse_electrode_map_x=t.clientX,E.mouse_electrode_map_y=t.clientY,w(t,e),E.dragging&&1==E.brush){const e=electrode_map.getContext("2d");e.fillStyle=o[E.active_electrode];for(let t of E.to_apply){let o=t[0]-n.left,l=t[1]-n.top;o=Math.round(o/(2*E.cellSize)),l=Math.round(l/(2*E.cellSize)),e.fillRect(o*r,l*r,r,r)}}}),electrode_map.addEventListener("mouseover",e=>{E.mouse_on_electrode_map=!0}),electrode_map.addEventListener("mouseout",t=>{if(E.mouse_on_electrode_map=!1,E.dragging=!1,E.initial_click=[-1,-1],1==E.brush){const t=electrode_map.getBoundingClientRect();for(let n of E.to_apply){let o=n[0]-t.left,r=n[1]-t.top;o=Math.round(o/(2*E.cellSize)),r=Math.round(r/(2*E.cellSize)),e.brush(o,r,E.active_electrode)}E.to_apply=[]}B(e)})}function M(e,t,n){return(n=n||new Float32Array(3))[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function z(e,t){t=t||new Float32Array(3);var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return n>1e-5&&(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n),t}function L(e,t,n){return(n=n||new Float32Array(3))[0]=e[1]*t[2]-e[2]*t[1],n[1]=e[2]*t[0]-e[0]*t[2],n[2]=e[0]*t[1]-e[1]*t[0],n}var T={lookAt:function(e,t,n,o){o=o||new Float32Array(16);var r=z(M(e,t)),l=z(L(n,r)),a=z(L(r,l));return o[0]=l[0],o[1]=l[1],o[2]=l[2],o[3]=0,o[4]=a[0],o[5]=a[1],o[6]=a[2],o[7]=0,o[8]=r[0],o[9]=r[1],o[10]=r[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o},xRotate:function(e,t,n){n=n||new Float32Array(16);var o=e[4],r=e[5],l=e[6],a=e[7],i=e[8],c=e[9],d=e[10],s=e[11],f=Math.cos(t),u=Math.sin(t);return n[4]=f*o+u*i,n[5]=f*r+u*c,n[6]=f*l+u*d,n[7]=f*a+u*s,n[8]=f*i-u*o,n[9]=f*c-u*r,n[10]=f*d-u*l,n[11]=f*s-u*a,e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},yRotate:function(e,t,n){n=n||new Float32Array(16);var o=e[0],r=e[1],l=e[2],a=e[3],i=e[8],c=e[9],d=e[10],s=e[11],f=Math.cos(t),u=Math.sin(t);return n[0]=f*o-u*i,n[1]=f*r-u*c,n[2]=f*l-u*d,n[3]=f*a-u*s,n[8]=f*i+u*o,n[9]=f*c+u*r,n[10]=f*d+u*l,n[11]=f*s+u*a,e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},perspective:function(e,t,n,o,r){r=r||new Float32Array(16);var l=Math.tan(.5*Math.PI-.5*e),a=1/(n-o);return r[0]=l/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=l,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=(n+o)*a,r[11]=-1,r[12]=0,r[13]=0,r[14]=n*o*a*2,r[15]=0,r},inverse:function(e,t){t=t||new Float32Array(16);var n=e[0],o=e[1],r=e[2],l=e[3],a=e[4],i=e[5],c=e[6],d=e[7],s=e[8],f=e[9],u=e[10],m=e[11],_=e[12],p=e[13],g=e[14],y=e[15],h=u*y,b=g*m,v=c*y,E=g*d,B=c*m,I=u*d,x=r*y,k=g*l,S=r*m,w=u*l,A=r*d,M=c*l,z=s*p,L=_*f,T=a*p,F=_*i,R=a*f,C=s*i,P=n*p,$=_*o,O=n*f,U=s*o,D=n*i,N=a*o,j=h*i+E*f+B*p-(b*i+v*f+I*p),q=b*o+x*f+w*p-(h*o+k*f+S*p),V=v*o+k*i+A*p-(E*o+x*i+M*p),X=I*o+S*i+M*f-(B*o+w*i+A*f),W=1/(n*j+a*q+s*V+_*X);return t[0]=W*j,t[1]=W*q,t[2]=W*V,t[3]=W*X,t[4]=W*(b*a+v*s+I*_-(h*a+E*s+B*_)),t[5]=W*(h*n+k*s+S*_-(b*n+x*s+w*_)),t[6]=W*(E*n+x*a+M*_-(v*n+k*a+A*_)),t[7]=W*(B*n+w*a+A*s-(I*n+S*a+M*s)),t[8]=W*(z*d+F*m+R*y-(L*d+T*m+C*y)),t[9]=W*(L*l+P*m+U*y-(z*l+$*m+O*y)),t[10]=W*(T*l+$*d+D*y-(F*l+P*d+N*y)),t[11]=W*(C*l+O*d+N*m-(R*l+U*d+D*m)),t[12]=W*(T*u+C*g+L*c-(R*g+z*c+F*u)),t[13]=W*(O*g+z*r+$*u-(P*u+U*g+L*r)),t[14]=W*(P*c+N*g+F*r-(D*g+T*r+$*c)),t[15]=W*(D*u+R*r+U*c-(O*c+N*u+C*r)),t},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross:L,normalize:z,subtractVectors:M,translate:function(e,t,n,o,r){r=r||new Float32Array(16);var l=e[0],a=e[1],i=e[2],c=e[3],d=e[4],s=e[5],f=e[6],u=e[7],m=e[8],_=e[9],p=e[10],g=e[11],y=e[12],h=e[13],b=e[14],v=e[15];return e!==r&&(r[0]=l,r[1]=a,r[2]=i,r[3]=c,r[4]=d,r[5]=s,r[6]=f,r[7]=u,r[8]=m,r[9]=_,r[10]=p,r[11]=g),r[12]=l*t+d*n+m*o+y,r[13]=a*t+s*n+_*o+h,r[14]=i*t+f*n+p*o+b,r[15]=c*t+u*n+g*o+v,r}};const F=["VERTEX_SHADER","FRAGMENT_SHADER"],R=/^[ \t]*\n/,C=/(\.|\[|]|\w+)/g,P=/coord|texture/i,$={},O="";function U(e,t){return function(n){if(n.value)switch(e.disableVertexAttribArray(t),n.value.length){case 4:e.vertexAttrib4fv(t,n.value);break;case 3:e.vertexAttrib3fv(t,n.value);break;case 2:e.vertexAttrib2fv(t,n.value);break;case 1:e.vertexAttrib1fv(t,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(34962,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,n.numComponents||n.size,n.type||5126,n.normalize||!1,n.stride||0,n.offset||0),void 0!==n.divisor&&e.vertexAttribDivisor(t,n.divisor)}}const D={};function N(e,t,n,o){const r=e.split(C).filter(e=>""!==e);let l=0,a="";for(;;){const e=r[l++];a+=e;const i=e[0]>="0"&&e[0]<="9",c=i?parseInt(e):e;i&&(a+=r[l++]);if(l===r.length){n[c]=t;break}{const e=r[l++],t="["===e,i=n[c]||(t?[]:{});n[c]=i,n=i,o[a]=o[a]||function(e){return function(t){setUniformTree(e,t)}}(i),a+=e}}}function j(...e){console.error(...e)}function q(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}function V(e,t){const n={program:t,uniformSetters:function(e,t){let n=0;function o(t,o,r){const l=o.name.endsWith("[0]"),a=o.type,i=$[a];if(!i)throw new Error("unknown type: 0x"+a.toString(16));let c;if(i.bindPoint){const t=n;n+=o.size,c=l?i.arraySetter(e,a,t,r,o.size):i.setter(e,a,t,r,o.size)}else c=i.arraySetter&&l?i.arraySetter(e,r):i.setter(e,r);return c.location=r,c}const r={},l={},a=e.getProgramParameter(t,35718);for(let n=0;n<a;++n){const a=e.getActiveUniform(t,n);if(q(a))continue;let i=a.name;i.endsWith("[0]")&&(i=i.substr(0,i.length-3));const c=e.getUniformLocation(t,a.name);if(c){const e=o(0,a,c);r[i]=e,N(i,e,l,r)}}return r}(e,t),attribSetters:function(e,t){const n={},o=e.getProgramParameter(t,35721);for(let r=0;r<o;++r){const o=e.getActiveAttrib(t,r);if(q(o))continue;const l=e.getAttribLocation(t,o.name),a=D[o.type],i=a.setter(e,l,a);i.location=l,n[o.name]=i}return n}(e,t)};return e.texStorage2D&&(n.uniformBlockSpec=function(e,t){const n=e.getProgramParameter(t,35718),o=[],r=[];for(let l=0;l<n;++l){r.push(l),o.push({});const n=e.getActiveUniform(t,l);o[l].name=n.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach((function(n){const l=n[0],a=n[1];e.getActiveUniforms(t,r,e[l]).forEach((function(e,t){o[t][a]=e}))}));const l={},a=e.getProgramParameter(t,35382);for(let n=0;n<a;++n){const o=e.getActiveUniformBlockName(t,n),r={index:e.getUniformBlockIndex(t,o),usedByVertexShader:e.getActiveUniformBlockParameter(t,n,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),usedByFragmentShader:e.getActiveUniformBlockParameter(t,n,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),size:e.getActiveUniformBlockParameter(t,n,UNIFORM_BLOCK_DATA_SIZE),uniformIndices:e.getActiveUniformBlockParameter(t,n,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)};r.used=r.usedByVertexShader||r.usedByFragmentShader,l[o]=r}return{blockSpecs:l,uniformData:o}}(e,t),n.transformFeedbackInfo=function(e,t){const n={},o=e.getProgramParameter(t,35971);for(let r=0;r<o;++r){const o=e.getTransformFeedbackVarying(t,r);n[o.name]={index:r,type:o.type,size:o.size}}return n}(e,t)),n}function X(e,t,n,o,r){const l=Y(n,o,r);let a=!0;if(t=t.map((function(e){if(e.indexOf("\n")<0){const t=getElementById(e);t?e=t.text:(l.errorCallback("no element with id: "+e),a=!1)}return e})),!a)return null;const i=function(e,t,n,o,r){const l=Y(n,o,r),a=[];for(let n=0;n<t.length;++n){const o=W(e,t[n],e[F[n]],l.errorCallback);if(!o)return null;a.push(o)}return function(e,t,n,o,r){const l=Y(n,o,r),a=[],i=[];for(let n=0;n<t.length;++n){let o=t[n];if("string"==typeof o){const t=getElementById(o),r=t?t.text:o;let a=e[F[n]];t&&t.type&&(a=getShaderTypeFromScriptType(e,t.type)||a),o=W(e,r,a,l.errorCallback),i.push(o)}"undefined"!=typeof WebGLShader&&o instanceof WebGLShader&&a.push(o)}if(a.length!==t.length)return l.errorCallback("not enough shaders for program"),deleteShaders(e,i),null;const c=e.createProgram();a.forEach((function(t){e.attachShader(c,t)})),l.attribLocations&&Object.keys(l.attribLocations).forEach((function(t){e.bindAttribLocation(c,l.attribLocations[t],t)}));let d=l.transformFeedbackVaryings;d&&(d.attribs&&(d=d.attribs),Array.isArray(d)||(d=Object.keys(d)),e.transformFeedbackVaryings(c,d,l.transformFeedbackMode||SEPARATE_ATTRIBS));e.linkProgram(c);if(!e.getProgramParameter(c,35714)){const t=e.getProgramInfoLog(c);return l.errorCallback(`${a.map(t=>{const n=addLineNumbersWithError(e.getShaderSource(t),"",0),o=e.getShaderParameter(t,e.SHADER_TYPE);return`${Q(e,o)}\n${n}}`}).join("\n")}\nError in program linking: ${t}`),e.deleteProgram(c),deleteShaders(e,i),null}return c}(e,a,l)}(e,t,l);return i?V(e,i):null}function W(e,t,n,o){const r=o||j,l=e.createShader(n);let a=0;R.test(t)&&(a=1,t=t.replace(R,"")),e.shaderSource(l,t),e.compileShader(l);if(!e.getShaderParameter(l,35713)){const o=e.getShaderInfoLog(l);return r(`${addLineNumbersWithError(t,o,a)}\nError compiling ${Q(e,n)}: ${o}`),e.deleteShader(l),null}return l}function Y(e,t,n){let o,r;if("function"==typeof t&&(n=t,t=void 0),"function"==typeof e)n=e,e=void 0;else if(e&&!Array.isArray(e)){if(e.errorCallback)return e;const t=e;n=t.errorCallback,e=t.attribLocations,o=t.transformFeedbackVaryings,r=t.transformFeedbackMode}const l={errorCallback:n||j,transformFeedbackVaryings:o,transformFeedbackMode:r};if(e){let n={};Array.isArray(e)?e.forEach((function(e,o){n[e]=t?t[o]:o})):n=e,l.attribLocations=n}return l}function H(e,t,n){const o=function(e,t){const n={};return Object.keys(t).forEach((function(o){if("indices"!==o){const r=t[o],l=r.attrib||r.name||r.attribName||O+o;if(r.value){if(!Array.isArray(r.value)&&!J(r.value))throw new Error("array.value is not array or typedarray");n[l]={value:r.value}}else{let t,a,i,c;if(r.buffer&&r.buffer instanceof WebGLBuffer)t=r.buffer,c=r.numComponents||r.size,a=r.type,i=r.normalize;else if("number"==typeof r||"number"==typeof r.data){const n=r.data||r,l=r.type||Float32Array,d=n*l.BYTES_PER_ELEMENT;a=getGLTypeForTypedArrayType(l),i=void 0!==r.normalize?r.normalize:getNormalizationForTypedArrayType(l),c=r.numComponents||r.size||ee(o,n),t=e.createBuffer(),e.bindBuffer(34962,t),e.bufferData(34962,d,r.drawType||35044)}else{const n=Z(r,o);t=G(e,n,void 0,r.drawType),a=K(n),i=void 0!==r.normalize?r.normalize:function(e){return e instanceof Int8Array||e instanceof Uint8Array}(n),c=function(e,t){return e.numComponents||e.size||ee(t,(e.length?e:e.data).length)}(r,o)}n[l]={buffer:t,numComponents:c,type:a,normalize:i,stride:r.stride||0,offset:r.offset||0,divisor:void 0===r.divisor?void 0:r.divisor,drawType:r.drawType}}}})),e.bindBuffer(34962,null),n}(e,t),r=Object.assign({},n||{});r.attribs=Object.assign({},n?n.attribs:{},o);const l=t.indices;if(l){const t=Z(l,"indices");r.indices=G(e,t,34963),r.numElements=t.length,r.elementType=K(t)}else r.numElements||(r.numElements=getNumElementsFromAttributes(e,r.attribs));return r}function G(e,t,n,o){n=n||34962;const r=e.createBuffer();return function(e,t,n,o,r){e.bindBuffer(t,n),e.bufferData(t,o,r||35044)}(e,n,r,t,o),r}function K(e){if(e instanceof Int8Array)return 5120;if(e instanceof Uint8Array)return 5121;if(e instanceof Uint8ClampedArray)return 5121;if(e instanceof Int16Array)return 5122;if(e instanceof Uint16Array)return 5123;if(e instanceof Int32Array)return 5124;if(e instanceof Uint32Array)return 5125;if(e instanceof Float32Array)return 5126;throw new Error("unsupported typed array type")}D[35664]={size:8,setter:U},D[35665]={size:12,setter:U},D[35666]={size:16,setter:U},D[35676]={size:16,setter:function(e,t,n){const o=n.size,r=n.count;return function(n){e.bindBuffer(34962,n.buffer);const l=n.size||n.numComponents||o,a=l/r,i=n.type||5126,c=$[i].size*l,d=n.normalize||!1,s=n.offset||0,f=c/r;for(let o=0;o<r;++o)e.enableVertexAttribArray(t+o),e.vertexAttribPointer(t+o,a,i,d,c,s+f*o),void 0!==n.divisor&&e.vertexAttribDivisor(t+o,n.divisor)}},count:4},$[35664]={Type:Float32Array,size:8,setter:function(e,t){return function(n){e.uniform2fv(t,n)}},cols:2},$[35665]={Type:Float32Array,size:12,setter:function(e,t){return function(n){e.uniform3fv(t,n)}},cols:3},$[35666]={Type:Float32Array,size:16,setter:function(e,t){return function(n){e.uniform4fv(t,n)}},cols:4},$[35676]={Type:Float32Array,size:64,setter:function(e,t){return function(n){e.uniformMatrix4fv(t,!1,n)}},rows:4,cols:4},$[35678]={Type:null,size:0,setter:function(e,t,n,o){var r=$[t].bindPoint;return function(t){e.uniform1i(o,n),e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,t)}},arraySetter:function(e,t,n,o,r){for(var l=$[t].bindPoint,a=new Int32Array(r),i=0;i<r;++i)a[i]=n+i;return function(t){e.uniform1iv(o,a),t.forEach((function(t,n){e.activeTexture(e.TEXTURE0+a[n]),e.bindTexture(l,t)}))}},bindPoint:3553};const J="undefined"!=typeof SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer};function Z(e,t){if(J(e))return e;if(J(e.data))return e.data;Array.isArray(e)&&(e={data:e});let n=e.type;return n||(n="indices"===t?Uint32Array:Float32Array),new n(e.data)}const Q=function(){const e={},t={};return function(n,o){return function(n){const o=n.constructor.name;if(!e[o]){for(const e in n)if("number"==typeof n[e]){const o=t[n[e]];t[n[e]]=o?`${o} | ${e}`:e}e[o]=!0}}(n),t[o]||("number"==typeof o?"0x"+o.toString(16):o)}}();function ee(e,t){let n;return n=P.test(e)?2:3,n}function te(e){return e*Math.PI/180}function ne(e){const t=te(2*Math.PI/180),n=e.positions,o=e.texcoords,r=e.indices,l=function(e,t){const n=[];for(let o=0;o<e.length/3;o++){const r=3*e[3*o],l=3*e[3*o+1],a=3*e[3*o+2],i=t.slice(r,r+3),c=t.slice(l,l+3),d=t.slice(a,a+3);n.push(T.normalize(T.cross(T.subtractVectors(i,c),T.subtractVectors(d,c))))}return n}(r,n),a=function(e){let t={},n=0;const o=[];for(let r=0;r<e.length;r++){const l=3*r,a=e.slice(l,l+3),i=a[0]+","+a[1]+","+a[2];void 0===t[i]&&(t[i]=n++),o.push(t[i])}return o}(n),i=function(e,t){const n=[];for(let o=0;o<t.length;++o){const r=e[t[o]];n[r]=n[r]?n[r]:[],n[r].push(Math.floor(o/3))}return n}(a,r),c=[],d=[],s=[],f=[];let u={},m=0;const _=Math.cos(t);for(let e=0;e<r.length;++e){const t=l[Math.floor(e/3)],p=r[e],g=[0,0,0];i[a[p]].forEach(e=>{const n=l[e];T.dot(t,n)>_&&(g[0]+=n[0],g[1]+=n[1],g[2]+=n[2])}),T.normalize(g,g);const y=3*p,h=2*p,b=n[y+0],v=n[y+1],E=n[y+2],B=g[0],I=g[1],x=g[2],k=o[h+0],S=o[h+1],w=`${b},${v},${E},${B},${I},${x},${k},${S}`;void 0===u[w]&&(u[w]=m++,c.push(b,v,E),s.push(B,I,x),d.push(k,S)),f.push(u[w])}Uint32Array.from(f);return{position:c,texcoord:d,normal:s,indices:f}}function oe(e){let t;E.efmap_altered||null===E.efmap_pixels?(t=e.efpix(),E.efmap_altered=0,E.efmap_pixels=t):t=E.efmap_pixels;const n=Math.max(...t),o=Math.min(...t);if(!E.fake_canvas){E.fake_canvas=document.createElement("canvas").getContext("2d"),E.fake_canvas.canvas.width=E.canvas_width,E.fake_canvas.canvas.height=E.canvas_height;for(let e=0;e<E.map_width;e++)for(let r=0;r<E.map_height;r++){let l=t[r*E.map_width+e],a=Math.floor((l-o)/(n-o)*255);E.fake_canvas.fillStyle=E.cmap[a],E.fake_canvas.fillRect(e,r,E.cellSize,E.cellSize)}E.refresh_canvas=0}let r=E.fake_canvas.getImageData(0,0,E.map_width,E.map_height);const l=ne(function(e,t,n,o,r){let l=e=>50*Math.floor((e-n)/(t-n)*99)/99;const a=[],i=[],c=[],d=[],s=o-1,f=r-1;for(let t=0;t<f;t++)for(let n=0;n<s;n++){if(void 0!==a[`${n},${t}`])continue;const r=i.length/3,u=t*o+n,m=u+o,_=m+o,p=l(e[u+0]),g=l(e[u+1]),y=l(e[m+0]),h=l(e[m+1]),b=n,v=t;let E=n+1,B=t+1;const I=n/s,x=t/f;let k=E/s,S=B/f;if(n<s-2&&t<f-1){const o=l(e[u+2]),r=l(e[m+2]),i=l(e[_+0]),c=l(e[_+1]),d=l(e[_+2]);p==o&&o==d&&i==o?(a[`${n+1},${t+1}`]=1,a[`${n+0},${t+1}`]=1,a[`${n+1},${t+0}`]=1,E+=1,B+=1,k=E/s,S=B/f):p==g&&o==g&&r==h&&y==h?(E+=1,k=E/s,a[`${n+1},${t+0}`]=1):p==i&&i==c&&c==g&&(B+=1,S=B/f,a[`${n+0},${t+1}`]=1)}i.push(b,p,v,E,g,v,b,y,B,E,h,B),c.push(I,x,k,x,I,S,k,S),d.push(r,r+3,r+1,r,r+2,r+3)}return{positions:i,texcoords:c,indices:d}}(t,n,o,E.map_width,E.map_height)),a=E.gl;a.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT),a.bindTexture(a.TEXTURE_2D,a.createTexture()),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r),a.generateMipmap(a.TEXTURE_2D),E.delta_ef_map_y=0,E.delta_ef_map_x=0,E.three_d_zoom_level=0,E.programInfo=X(a,["attribute vec4 position;\nattribute vec3 normal;\nattribute vec2 texcoord;\nuniform mat4 projection;\nuniform mat4 modelView;\nvarying vec3 v_normal;\nvarying vec2 v_texcoord;\nvoid main() {\n  gl_Position = projection * modelView * position;\n  v_normal = mat3(modelView) * normal;\n  v_texcoord = texcoord;\n}\n","precision highp float;\nvarying vec3 v_normal;\nvarying vec2 v_texcoord;\nvarying float v_modelId;\nuniform sampler2D u_texture;\nvoid main() {\n  vec3 lightDirection = normalize(vec3(1, 2, -3));  // arbitrary light direction\n  float l = dot(lightDirection, normalize(v_normal)) * .5 + .5;\n  highp vec4 texelColor = texture2D(u_texture, v_texcoord);\n  gl_FragColor = vec4(texelColor.rgb * l, texelColor.a);\n}\n"]),E.bufferInfo=H(a,l),requestAnimationFrame(re)}function re(){try{const e=E.gl;E.delta_ef_map_x=Math.min(89,E.delta_ef_map_x),E.delta_ef_map_x=Math.max(0,E.delta_ef_map_x);let t=te(-E.delta_ef_map_y),n=te(-E.delta_ef_map_x);!function(e){const t=0|e.clientWidth,n=0|e.clientHeight;e.width===t&&e.height===n||(e.width=t,e.height=n)}(E.gl.canvas);const o=te(11.5),r=e.canvas.clientWidth/e.canvas.clientHeight,l=10,a=2e3,i=T.perspective(o,r,l,a),c=[0,1010+E.three_d_zoom_level,1],d=[0,0,0],s=[0,1,0],f=T.lookAt(c,d,s);let u=T.inverse(f);u=T.xRotate(u,n),u=T.yRotate(u,t),u=T.translate(u,-E.map_width/2,0,-E.map_height/2),e.viewport(0,0,e.canvas.width,e.canvas.height),e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.useProgram(E.programInfo.program),function(e,t,n){n.vertexArrayObject?e.bindVertexArray(n.vertexArrayObject):(!function(e,t){for(const n in t){const o=e[n];o&&o(t[n])}}(t.attribSetters||t,n.attribs),n.indices&&e.bindBuffer(34963,n.indices))}(e,E.programInfo,E.bufferInfo),function e(t,...n){const o=t.uniformSetters||t,r=n.length;for(let t=0;t<r;++t){const r=n[t];if(Array.isArray(r)){const t=r.length;for(let n=0;n<t;++n)e(o,r[n])}else for(const e in r){const t=o[e];t&&t(r[e])}}}(E.programInfo,{projection:i,modelView:u});const m=0;e.drawElements(e.TRIANGLES,E.bufferInfo.numElements,e.UNSIGNED_INT,m),requestAnimationFrame(re)}catch(e){E.three_dimension_view&&(E.three_dimension_view=0)}}function le(e){const t=e.efpix();E.efmap_pixels=t;let n=document.getElementById("electric_field_map");if(E.three_dimension_view)null===E.gl&&(E.gl=n.getContext("webgl2")),oe(e);else{const e=n.getContext("2d"),o=Math.max(...t),r=Math.min(...t);for(let n=0;n<E.map_width;n++)for(let l=0;l<E.map_height;l++){let a=t[l*E.map_width+n],i=Math.floor((a-r)/(o-r)*255);e.fillStyle=E.cmap[i],e.fillRect(n*E.cellSize,l*E.cellSize,E.cellSize,E.cellSize)}}}function ae(e){let t=document.getElementById("electric_field_map");if(E.three_d_zoom_level=0,E.three_dimension_view)t.addEventListener("click",e=>{const n=t.getBoundingClientRect();E.current_x_position=(e.clientX-n.left)/E.cellSize,E.current_y_position=(e.clientY-n.top)/E.cellSize,document.getElementById("x-position").value=E.current_x_position,document.getElementById("y-position").value=E.map_height-E.current_y_position}),t.addEventListener("mousemove",e=>{if(E.dragging){let t=E.mouse_ef_map_y,n=E.mouse_ef_map_x;E.mouse_ef_map_y=e.clientX,E.mouse_ef_map_x=e.clientY,E.delta_ef_map_x+=n-E.mouse_ef_map_x,E.delta_ef_map_y+=t-E.mouse_ef_map_y}}),t.addEventListener("mousedown",e=>{E.dragging=!0,E.mouse_ef_map_y=e.clientX,E.mouse_ef_map_x=e.clientY}),t.addEventListener("mouseup",e=>{E.dragging=!1}),t.addEventListener("wheel",e=>{e.preventDefault(),E.three_d_zoom_level+=e.deltaY/2});else{let t=document.getElementById("electric_field_map");t.addEventListener("click",n=>{const o=t.getBoundingClientRect();E.current_x_position=(n.clientX-o.left)/E.cellSize,E.current_y_position=(n.clientY-o.top)/E.cellSize,document.getElementById("x-position").value=E.current_x_position,document.getElementById("y-position").value=E.map_height-E.current_y_position,ie(e,E.current_x_position,E.current_y_position)}),t.addEventListener("mousemove",n=>{const o=t.getBoundingClientRect();let r=n.clientX-o.left,l=n.clientY-o.top;if(r=Math.floor(r/E.cellSize),l=Math.floor(l/E.cellSize),r>=0&&l>=0){let t=e.getef(r,l);r=(""+r).padStart(3," "),l=(""+(e.height()-l-1)).padStart(3," "),t=(""+t.toFixed(2)).padStart(5," "),document.getElementById("status").innerHTML=`x: ${r} y: ${l}\nvolts: ${t}`}})}}function ie(e,t,n){if(E.electric_fields_calculated){e.update_voltages(E.electrode_volts),e.update_offsets(E.electrode_offsets),E.no_lines=!1;let o=t+.001,r=n+.001,l=E.current_x_velocity+.001,a=-(E.current_y_velocity+.001),i=E.current_mz,c=Math.random();if(0!=E.random_ke){let e=2*c*Math.PI,t=160218e-24*E.random_ke,n=Math.sqrt(2*t/(1660538921e-36*i))/1e3;l+=n*Math.cos(e),a+=n*Math.sin(e)}E.latest_ion=[o,r,l,a,i,c];let d=e.fly_ion(E.latest_ion);E.latest_ion_path=d.slice(0,-1);let s=E.latest_ion_path.length;if(E.three_dimension_view){ce(E.fake_canvas,1);const e=E.gl;let t=E.fake_canvas.getImageData(0,0,E.map_width,E.map_height);e.bindTexture(e.TEXTURE_2D,e.createTexture()),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D)}else{ce(document.getElementById("electric_field_map").getContext("2d"),E.cellSize)}ce(document.getElementById("electrode_map").getContext("2d"),E.cellSize);let f=E.latest_ion_path[s-2].toFixed(0),u=e.height()-E.latest_ion_path[s-1].toFixed(0)-1,m=`${s/3>=E.max_time?"Time!!":"Splat!"} ${s/3}ns ${i}mz ${`(${o.toFixed(0)},${r.toFixed(0)})->(${f},${u})`} ${d[d.length-1]} collisions`;E.splatlog.push(m),document.getElementById("splatlog").innerHTML=E.splatlog.join("\n")}else e.update_voltages(E.electrode_volts),e.generate_electric_fields(),E.electric_fields_calculated=!0,le(e)}function ce(e,t){e.beginPath(),e.strokeStyle="#000",e.moveTo(E.latest_ion_path[1]*t,E.latest_ion_path[2]*t);var n=800,o=800;for(let r=0;r<E.latest_ion_path.length;r+=3){let l=E.latest_ion_path[r+1]*t,a=E.latest_ion_path[r+2]*t;Math.abs(l-n)+Math.abs(a-o)>.25&&(e.lineTo(l,a),n=l,o=a)}e.stroke()}function de(){document.getElementById("splattable").disabled=!Boolean(E.active_electrode),document.getElementById("splattable").checked=E.splattable[E.active_electrode],document.getElementById("dc_mode").disabled=!Boolean(E.active_electrode),document.getElementById("dc_mode").checked=!E.dc_only[E.active_electrode],document.getElementById("magnet_mode").checked=E.magnet_mode[E.active_electrode],document.getElementById("sin_frequency").value=E.electrode_frequencies[E.active_electrode],document.getElementById("offset").value=E.electrode_offsets[E.active_electrode],document.getElementById("magnet_mode").checked?(document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("dc_mode").disabled=!0,document.getElementById("splattable").disabled=!0):document.getElementById("dc_mode").checked?(document.getElementById("sin_frequency").disabled=!1,document.getElementById("offset").disabled=!1,document.getElementById("pulse_start").disabled=!0,document.getElementById("pulse_end").disabled=!0):(document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("pulse_start").disabled=!1,document.getElementById("pulse_end").disabled=!1),document.getElementById("voltage_input").value=0==E.active_electrode?0:E.electrode_volts[E.active_electrode]}function se(e,t,n,r,I,x){const k=document.getElementById("voltage_input");k.oninput=()=>{if(0!=E.active_electrode){const t=k.value;t<=2e4&&t>=-2e4&&(E.electrode_volts[E.active_electrode]=t,e.update_voltages(E.electrode_volts),E.voltages_were_updated=!0),E.efmap_altered=1}},document.getElementById("electrode1").style.boxShadow="0px 0px 3px 1px black";for(let e=0;e<o.length;e++)document.getElementById("electrode"+e).style.background=l[e],document.getElementById("electrode"+e).addEventListener("click",()=>{E.active_electrode=e,de();for(let e=0;e<o.length;e++)document.getElementById("electrode"+e).style.boxShadow=e==E.active_electrode?"0px 0px 3px 1px black":"";k.value=0==e?0:E.electrode_volts[E.active_electrode]});document.getElementById("brush1").style.boxShadow="0px 0px 3px 1px black";for(let e=1;e<6;e++)document.getElementById("brush"+e).addEventListener("click",t=>{E.brush=e;for(let e=1;e<6;e++)document.getElementById("brush"+e).style.boxShadow=e==E.brush?"0px 0px 3px 1px black":""});document.getElementById("brush6").addEventListener("click",t=>{!function(e){if(0==E.history1&&0==E.history2)return;E.history3=E.history2,E.history2=E.history1,E.history1=0;let t=E.map_width/2,n=E.map_height/2;for(let o=0;o<t;o++)for(let r=0;r<n;r++){let n=E.history3[o+t*r];e.brush(o,r,n)}E.emap_altered=!0}(e)}),document.getElementById("splattable").addEventListener("change",t=>{E.splattable[E.active_electrode]=t.target.checked&&0!=E.active_electrode?1:0,B(e)}),document.getElementById("dc_mode").addEventListener("change",e=>{e.target.checked&&0!=E.active_electrode?(E.dc_only[E.active_electrode]=0,document.getElementById("sin_frequency").disabled=!1,document.getElementById("offset").disabled=!1,document.getElementById("pulse_start").disabled=!0,document.getElementById("pulse_end").disabled=!0):(E.dc_only[E.active_electrode]=1,document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("pulse_start").disabled=!1,document.getElementById("pulse_end").disabled=!1)}),document.getElementById("magnet_mode").addEventListener("change",t=>{t.target.checked&&0!=E.active_electrode?(E.magnet_mode[E.active_electrode]=1,document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("dc_mode").disabled=!0,document.getElementById("splattable").disabled=!0,document.getElementById("pulse_start").disabled=!0,document.getElementById("pulse_end").disabled=!0):(E.magnet_mode[E.active_electrode]=0,document.getElementById("sin_frequency").disabled=!1,document.getElementById("offset").disabled=!1,document.getElementById("dc_mode").disabled=!1,document.getElementById("splattable").disabled=!1,document.getElementById("pulse_start").disabled=!1,document.getElementById("pulse_end").disabled=!1),de(),B(e)}),document.getElementById("update").addEventListener("click",t=>{e.update_voltages(E.electrode_volts),e.update_solids(E.splattable),e.update_magnets(E.magnet_mode),de(),console.log(`Updated voltages ${E.electrode_volts} and solids ${E.splattable}`),e.update_timeline(E.dc_only,E.electrode_frequencies,E.pulse_starts,E.pulse_ends),console.log("Made timeline"),e.generate_electric_fields(),E.electric_fields_calculated=!0,E.fake_canvas=null,le(e)}),document.getElementById("fly'm").addEventListener("click",t=>{E.current_x_position=parseFloat(document.getElementById("x-position").value),E.current_y_position=E.map_height-parseFloat(document.getElementById("y-position").value),ie(e,E.current_x_position,E.current_y_position)}),document.getElementById("clear").addEventListener("click",t=>{E.no_lines=!0,e.clear(),de(),S(e),B(e)}),document.getElementById("einzel_lens").addEventListener("click",n=>fe(e,t,s,a,c,i,0,d,d)),document.getElementById("tof").addEventListener("click",t=>fe(e,n,f,u,c,i,0,d,d)),document.getElementById("quadrupole").addEventListener("click",t=>fe(e,r,m,a,_,v,0,p,d)),document.getElementById("cyclotron").addEventListener("click",t=>fe(e,I,m,a,g,v,0,d,y)),document.getElementById("ion_funnel").addEventListener("click",t=>fe(e,x,h,a,b,v,30,d,d)),document.getElementById("SIMION_SAVE").addEventListener("click",t=>{e.generate_electrodes();let n=e.save_simion_pa();var o=new Blob([n],{type:"octet/stream"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(o,"electrodes.pa");else{let e=document.createElement("a"),t=URL.createObjectURL(o);e.href=t,e.download="electrodes.pa",document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e),window.URL.revokeObjectURL(t)}),0)}});let w=document.getElementById("3d_view");w.addEventListener("click",t=>{E.refresh_canvas=1;let n=document.getElementById("electric_field_map"),o=n.cloneNode(!1);n.parentNode.replaceChild(o,n),E.three_dimension_view?(w.innerHTML="3D</br>view",E.gl=null,E.three_dimension_view=0):(w.innerHTML="2D</br>view",E.gl=n.getContext("webgl2"),E.three_dimension_view=1),ae(e),le(e)}),document.getElementById("mz_ratio").addEventListener("input",e=>{E.current_mz=parseFloat(document.getElementById("mz_ratio").value)}),document.getElementById("ion_x_velocity").addEventListener("input",e=>{E.current_x_velocity=parseFloat(document.getElementById("ion_x_velocity").value)}),document.getElementById("ion_y_velocity").addEventListener("input",e=>{E.current_y_velocity=parseFloat(document.getElementById("ion_y_velocity").value)}),document.getElementById("randomizer").addEventListener("input",e=>{E.random_ke=parseFloat(document.getElementById("randomizer").value)}),document.getElementById("fdm_threshold").addEventListener("change",t=>{e.update_fdm_threshold(parseFloat(document.getElementById("fdm_threshold").value))}),document.getElementById("pulse_start").addEventListener("input",e=>{E.pulse_starts[E.active_electrode]=parseFloat(document.getElementById("pulse_start").value)}),document.getElementById("pulse_end").addEventListener("input",e=>{E.pulse_ends[E.active_electrode]=parseFloat(document.getElementById("pulse_end").value)}),document.getElementById("pressure").addEventListener("input",t=>{E.pressure=parseFloat(document.getElementById("pressure").value),e.update_pressure(E.pressure)}),document.getElementById("bg_gas").addEventListener("change",t=>{E.background_gas_mass=parseFloat(document.getElementById("bg_gas").value),e.update_gas_mass(E.background_gas_mass)}),document.getElementById("sin_frequency").addEventListener("input",e=>{E.electrode_frequencies[E.active_electrode]=parseFloat(document.getElementById("sin_frequency").value)}),document.getElementById("offset").addEventListener("input",t=>{E.electrode_offsets[E.active_electrode]=parseFloat(document.getElementById("offset").value),e.update_offsets(E.electrode_offsets)})}function fe(e,t,n,o,r,l,a,i,c){let d=E.map_width/2,s=E.map_height/2;for(let n=0;n<d;n++)for(let o=0;o<s;o++){let r=t[n+d*o];e.brush(n,o,r)}E.emap_altered=!0;for(let e=0;e<n.length;e++)E.electrode_volts[e]=n[e],E.splattable[e]=o[e];for(let e=0;e<r.length;e++)E.electrode_frequencies[e]=r[e],E.dc_only[e]=l[e],E.electrode_offsets[e]=i[e],E.magnet_mode[e]=c[e];e.update_pressure(a),e.update_gas_mass(28),e.update_offsets(i),e.update_magnets(E.magnet_mode),document.getElementById("pressure").value=a,document.getElementById("bg_gas").getElementsByTagName("option")[0].selected="selected",de(),S(e)}function ue(e){E.dragging||1==E.brush||(E.to_apply=[]);for(let e=1;e<5;e++)document.getElementById("electrode"+e).innerHTML=`${E.electrode_volts[e]} ${E.magnet_mode[e]?"T":"V"}`;document.getElementById("set_voltage").innerHTML=E.magnet_mode[E.active_electrode]?"Set Teslas":"Set Volts",E.mouse_on_electrode_map&&function(e){if(!E.dragging){const t=e.scale(),n=E.cellSize*t;let r=document.getElementById("electrode_map");const l=r.getBoundingClientRect();let a=E.mouse_electrode_map_x-l.left,i=E.mouse_electrode_map_y-l.top;if(a=Math.floor(a/(2*E.cellSize)),i=Math.floor(i/(2*E.cellSize)),E.previous_mouse_electrode_position_x2!=a||E.previous_mouse_electrode_position_y2!=i){B(e),E.previous_mouse_electrode_position_x2=a,E.previous_mouse_electrode_position_y2=i;const t=r.getContext("2d");if(t.fillStyle=o[E.active_electrode],1==E.brush||5==E.brush)t.fillRect(a*n,i*n,1*n,1*n);else if(2==E.brush)if(-1==E.initial_click[0]&&-1==E.initial_click[1])t.fillRect(a*n,i*n,n,n);else{let e=I(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),a,i);for(let o of e)t.fillRect(o[0]*n,o[1]*n,n,n)}else if(3==E.brush)if(-1==E.initial_click[0]&&-1==E.initial_click[1])t.fillRect(a*n,i*n,n,n);else{let e=k(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),a,i);for(let o of e)t.fillRect(o[0]*n,o[1]*n,n,n)}else if(4==E.brush)if(-1==E.initial_click[0]&&-1==E.initial_click[1])t.fillRect(a*n,i*n,n,n);else{let e=x(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),a,i);for(let o of e)t.fillRect(o[0]*n,o[1]*n,n,n)}}}}(e),E.emap_altered&&(E.emap_altered=!1,B(e)),E.voltages_were_updated&&(le(e),E.voltages_were_updated=!1)}!async function(){document.getElementById("dummyplayground").style.display="inline-block";const e=await n.e(1).then(n.bind(null,4)).catch(console.error),t=new e.Environment(E.map_width,E.map_height,E.scale,E.max_time,E.electrode_volts,E.splattable,E.pressure,E.background_gas_mass);let o=document.getElementById("electrode_map"),r=document.getElementById("electric_field_map");var l,a,i;window.screen.height*window.devicePixelRatio<1070&&(E.cellSize=2,E.canvas_height=400,E.canvas_width=400,r.width="400",r.height="400",o.width="400",o.height="400",document.getElementById("status").style.bottom="-445px",document.getElementById("status").style.left="-380px",document.getElementById("splatlog").style.width="280px"),ae(t),A(t),se(t,e.lens(),e.tof(),e.quad(),e.cyclotron(),e.funnel()),function(){var e=document.getElementsByClassName("collapsible");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(){this.classList.toggle("active");var e=this.nextElementSibling;"block"==e.style.display?e.style.display="none":e.style.display="block"})),e[t].nextElementSibling.style.display="none";let t=document.getElementById("playground");t.click(),t.click();let n=document.getElementById("playgrounddiv");t.addEventListener("click",e=>{"rgb(243, 243, 243)"==n.style.backgroundColor?(n.style.backgroundColor="",n.style.boxShadow=""):(n.style.backgroundColor="rgb(243, 243, 243)",n.style.boxShadow="0 2px 3px 0 #00000033, 0 2px 4px 0 #00000030")}),document.getElementById("advanced").click(),document.getElementById("advanced").click(),document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0}(),B(t),le(t),function(){let e=location.pathname.split("/"),t=e[e.length-1];if(""!==t){let e=document.querySelectorAll(".topnav a");for(let n=0,o=e.length;n<o;n++)0==e[n].getAttribute("href").indexOf(t)&&(e[n].className+="current_page")}}(),l=document.getElementById("topnav"),a=document.getElementById("playgrounddiv"),i=a.offsetTop+l.offsetHeight,window.onscroll=()=>{window.pageYOffset>i?a.classList.add("sticky"):a.classList.remove("sticky")},document.getElementById("dummyplayground").style.display="none",document.getElementById("playgrounddiv").style.display="inline-block",setInterval(ue.bind(null,t,o),60)}()}]);