!function(e){function t(t){for(var n,l,c=t[0],r=t[1],i=0,d=[];i<c.length;i++)l=c[i],Object.prototype.hasOwnProperty.call(o,l)&&o[l]&&d.push(o[l][0]),o[l]=0;for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);for(s&&s(t);d.length;)d.shift()()}var n={},o={0:0};var l={};var c={2:function(){return{"./index_bg.js":{__wbindgen_string_new:function(e,t){return n[1].exports.d(e,t)},__wbg_log_be5faf67a2e8b869:function(e){return n[1].exports.b(e)},__wbindgen_object_drop_ref:function(e){return n[1].exports.c(e)},__wbindgen_throw:function(e,t){return n[1].exports.e(e,t)}}}}};function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.e=function(e){var t=[],n=o[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise((function(t,l){n=o[e]=[t,l]}));t.push(n[2]=i);var d,a=document.createElement("script");a.charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.src=function(e){return r.p+""+({}[e]||e)+".js"}(e);var s=new Error;d=function(t){a.onerror=a.onload=null,clearTimeout(f);var n=o[e];if(0!==n){if(n){var l=t&&("load"===t.type?"missing":t.type),c=t&&t.target&&t.target.src;s.message="Loading chunk "+e+" failed.\n("+l+": "+c+")",s.name="ChunkLoadError",s.type=l,s.request=c,n[1](s)}o[e]=void 0}};var f=setTimeout((function(){d({type:"timeout",target:a})}),12e4);a.onerror=a.onload=d,document.head.appendChild(a)}return({1:[2]}[e]||[]).forEach((function(e){var n=l[e];if(n)t.push(n);else{var o,i=c[e](),d=fetch(r.p+""+{2:"6b221827c613f3f1a229"}[e]+".module.wasm");if(i instanceof Promise&&"function"==typeof WebAssembly.compileStreaming)o=Promise.all([WebAssembly.compileStreaming(d),i]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"==typeof WebAssembly.instantiateStreaming)o=WebAssembly.instantiateStreaming(d,i);else{o=d.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,i)}))}t.push(l[e]=o.then((function(t){return r.w[e]=(t.instance||t).exports})))}})),Promise.all(t)},r.m=e,r.c=n,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r.oe=function(e){throw console.error(e),e},r.w={};var i=window.webpackJsonp=window.webpackJsonp||[],d=i.push.bind(i);i.push=t,i=i.slice();for(var a=0;a<i.length;a++)t(i[a]);var s=d;r(r.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"electrode_map",(function(){return m})),n.d(t,"electric_field_map",(function(){return g})),n.d(t,"time_line",(function(){return b})),n.d(t,"cellSize",(function(){return h})),n.d(t,"green200",(function(){return p})),n.d(t,"amber200",(function(){return v})),n.d(t,"blue700",(function(){return y})),n.d(t,"max_time",(function(){return E}));const o=["#ffffff","#f44336","#4CAF50","#2196F3","#795548"];var l={electrode_volts:[0,500,1e3,-500,-1e3],electrode_frequencies:[0,1600,1600,1600,1600],active_electrode:1,emap_altered:!1,dragging:!1,brush_size:1,cmap:["#30123b","#311542","#32184a","#341b51","#351e58","#36215f","#372365","#38266c","#392972","#3a2c79","#3b2f7f","#3c3285","#3c358b","#3d3791","#3e3a96","#3f3d9c","#4040a1","#4043a6","#4145ab","#4148b0","#424bb5","#434eba","#4350be","#4353c2","#4456c7","#4458cb","#455bce","#455ed2","#4560d6","#4563d9","#4666dd","#4668e0","#466be3","#466de6","#4670e8","#4673eb","#4675ed","#4678f0","#467af2","#467df4","#467ff6","#4682f8","#4584f9","#4587fb","#4589fc","#448cfd","#438efd","#4291fe","#4193fe","#4096fe","#3f98fe","#3e9bfe","#3c9dfd","#3ba0fc","#39a2fc","#38a5fb","#36a8f9","#34aaf8","#33acf6","#31aff5","#2fb1f3","#2db4f1","#2bb6ef","#2ab9ed","#28bbeb","#26bde9","#25c0e6","#23c2e4","#21c4e1","#20c6df","#1ec9dc","#1dcbda","#1ccdd7","#1bcfd4","#1ad1d2","#19d3cf","#18d5cc","#18d7ca","#17d9c7","#17dac4","#17dcc2","#17debf","#18e0bd","#18e1ba","#19e3b8","#1ae4b6","#1be5b4","#1de7b1","#1ee8af","#20e9ac","#22eba9","#24eca6","#27eda3","#29eea0","#2cef9d","#2ff09a","#32f197","#35f394","#38f491","#3bf48d","#3ff58a","#42f687","#46f783","#4af880","#4df97c","#51f979","#55fa76","#59fb72","#5dfb6f","#61fc6c","#65fc68","#69fd65","#6dfd62","#71fd5f","#74fe5c","#78fe59","#7cfe56","#80fe53","#84fe50","#87fe4d","#8bfe4b","#8efe48","#92fe46","#95fe44","#98fe42","#9bfd40","#9efd3e","#a1fc3d","#a4fc3b","#a6fb3a","#a9fb39","#acfa37","#aef937","#b1f836","#b3f835","#b6f735","#b9f534","#bbf434","#bef334","#c0f233","#c3f133","#c5ef33","#c8ee33","#caed33","#cdeb34","#cfea34","#d1e834","#d4e735","#d6e535","#d8e335","#dae236","#dde036","#dfde36","#e1dc37","#e3da37","#e5d838","#e7d738","#e8d538","#ead339","#ecd139","#edcf39","#efcd39","#f0cb3a","#f2c83a","#f3c63a","#f4c43a","#f6c23a","#f7c039","#f8be39","#f9bc39","#f9ba38","#fab737","#fbb537","#fbb336","#fcb035","#fcae34","#fdab33","#fda932","#fda631","#fda330","#fea12f","#fe9e2e","#fe9b2d","#fe982c","#fd952b","#fd9229","#fd8f28","#fd8c27","#fc8926","#fc8624","#fb8323","#fb8022","#fa7d20","#fa7a1f","#f9771e","#f8741c","#f7711b","#f76e1a","#f66b18","#f56817","#f46516","#f36315","#f26014","#f15d13","#ef5a11","#ee5810","#ed550f","#ec520e","#ea500d","#e94d0d","#e84b0c","#e6490b","#e5460a","#e3440a","#e24209","#e04008","#de3e08","#dd3c07","#db3a07","#d93806","#d73606","#d63405","#d43205","#d23005","#d02f04","#ce2d04","#cb2b03","#c92903","#c72803","#c52602","#c32402","#c02302","#be2102","#bb1f01","#b91e01","#b61c01","#b41b01","#b11901","#ae1801","#ac1601","#a91501","#a61401","#a31201","#a01101","#9d1001","#9a0e01","#970d01","#940c01","#910b01","#8e0a01","#8b0901","#870801","#840701","#810602","#7d0502","#7a0402"],electric_fields_calculated:!1,latest_ion_path:[],latest_ion:[],current_random:0,current_number:1,current_mass:100,current_charge:1,current_x_velocity:0,current_y_velocity:0,mouse_on_electrode_map:!1,mouse_electrode_map_x:0,mouse_electrode_map_y:0,no_lines:!0,splatlog:[],time_events:[Array(401).fill("high"),Array(401).fill("high"),Array(401).fill("high"),Array(401).fill("high"),Array(401).fill("high")],time_first:1,time_second:0,time_line_mode:"iconic"};function c(e,t,n,o,l,c){const r=e.getContext("2d");for(let e=0;e<o;e++)for(let i=0;i<l;i++)r.fillStyle=t[n[i*o+e]],r.fillRect(e*c,i*c,c,c)}function r(e){const t=e.scale(),n=e.width()/t,l=e.height()/t,r=h*t;c(m,o,e.electrode_pixels(),n,l,r)}function i(e,t){if(l.mouse_electrode_map_x=e.clientX,l.mouse_electrode_map_y=e.clientY,!l.dragging&&"click"!=e.type)return;l.no_lines=!0;const n=m.getBoundingClientRect();let o=l.mouse_electrode_map_x-n.left,c=l.mouse_electrode_map_y-n.top;l.emap_altered=!0,o=Math.floor(o/(2*h)),c=Math.floor(c/(2*h)),o<0||c<0||(t.brush(o,c,l.active_electrode),2!=l.brush_size&&3!=l.brush_size||(t.brush(o+1,c,l.active_electrode),t.brush(o,c+1,l.active_electrode),t.brush(o+1,c+1,l.active_electrode),3==l.brush_size&&c>=1&&o>=1&&(t.brush(o-1,c-1,l.active_electrode),t.brush(o-1,c,l.active_electrode),t.brush(o-1,c+1,l.active_electrode),t.brush(o,c-1,l.active_electrode),t.brush(o+1,c-1,l.active_electrode))))}function d(e){c(electric_field_map,l.cmap,e.electric_field_pixels(),e.width(),e.height(),h)}function a(e){l.splatlog.push(e),document.getElementById("splatlog").innerHTML=l.splatlog.join("\n")}function s(e){const t=e.getContext("2d");t.beginPath(),t.strokeStyle="#000",t.moveTo(3*l.latest_ion_path[1],3*l.latest_ion_path[2]);var n=800,o=800;for(let e=0;e<l.latest_ion_path.length;e+=3){let c=3*l.latest_ion_path[e+1],r=3*l.latest_ion_path[e+2];Math.abs(c-n)+Math.abs(r-o)>.25&&(t.lineTo(c,r),n=c,o=r)}t.stroke()}function f(e){let t=l.time_first,n=l.time_second,c=l.time_line_mode;const r=e.getContext("2d"),i=e.width,d=e.height/2;if(r.fillStyle="#FFF",r.fillRect(0,0,i,e.height),r.strokeStyle="#000000",r.beginPath(),r.moveTo(Math.round(i*t)+.5,e.height),r.lineTo(Math.round(i*t)+.5,0),r.moveTo(Math.round(i*n)+.5,e.height),r.lineTo(Math.round(i*n)+.5,0),r.stroke(),0!=l.active_electrode&&(r.strokeStyle=o[l.active_electrode],"iconic"==c)){let t=l.electrode_volts[l.active_electrode],n=0;0!=t&&(n=-t/Math.abs(t));const o=d+e.height*n/4;let c=0,a="high",s=!1,f=0,u=l.time_events[l.active_electrode];r.moveTo(0,d);for(let t=0;t<u.length;t++){let n=u[t],l=1e3*t,d=l/E*i;if(n!=a&&s){for(let n=f;n<t;n++){let t=1e3*n/E*i,o=e.height/4,l=e.height/2,c=(n-f)/2;r.lineTo(t,Math.sin(c)*o+l)}f=0,s=!1}"high"==n?r.lineTo(d,o):"low"==n?r.lineTo(d,e.height/2):"sine"==n&&"sine"!=a&&(f=t,s=!0),a=n,c=l}r.stroke()}}function u(e){if(0==l.active_electrode)return;let t=400*Math.min(l.time_first,l.time_second),n=400*Math.max(l.time_first,l.time_second),o=l.time_events[l.active_electrode];for(let c=0;c<o.length;c++)c<n&&c>=t&&(l.time_events[l.active_electrode][c]=e);f(b)}function _(e){const t=document.getElementById("voltage_slider"),n=document.getElementById("voltage_input");t.oninput=()=>{0!=l.active_electrode&&(l.electrode_volts[l.active_electrode]=t.value,n.value=t.value)},n.oninput=()=>{if(0!=l.active_electrode){const e=n.value;e<=2e4&&e>=-2e4&&(l.electrode_volts[l.active_electrode]=e,t.value=e)}},document.getElementById("electrode1").style.background=o[1];for(let e=0;e<5;e++)document.getElementById("electrode"+e).addEventListener("click",()=>{l.active_electrode=e;for(let e=0;e<o.length;e++)document.getElementById("electrode"+e).style.background=e==l.active_electrode?o[e]:"";t.value=0==e?0:l.electrode_volts[l.active_electrode],n.value=t.value,f(b)});document.getElementById("brush1").style.background="#CFD8DC";for(let e=1;e<4;e++)document.getElementById("brush"+e).addEventListener("click",t=>{l.brush_size=e;for(let e=1;e<4;e++)document.getElementById("brush"+e).style.background=e==l.brush_size?"#CFD8DC":""});document.getElementById("clear").addEventListener("click",t=>{l.no_lines=!0,e.clear(),r(e)}),document.getElementById("update").addEventListener("click",t=>{e.update_voltages(l.electrode_volts),console.log("Updated voltages "+l.electrode_volts),function(e){let t=[];console.log("supposed len",e.timeline_length());let n=0;for(let o=0;o<l.electrode_volts.length;o++){let c=l.time_events[o][0],r="high",i=0,d=1e3*l.electrode_frequencies[o]*3.14159*2;for(let a=0;a<e.timeline_length()/1e3;a++){if(c=l.time_events[o][a],c!=r){if(console.log("different!Q"),"high"==r){console.log("yup");for(let e=0;e<1e3*(a-i);e++)t.push(1);console.log(t.length)}else if("low"==r)for(let e=0;e<1e3*(a-i);e++)t.push(0);else if("sine"==r)for(let e=0;e<1e3*(a-i);e++)n+=1,t.push(Math.sin(d*e*1e-9));i=a}r=c}if("high"==r)for(let n=0;n<1e3*(e.timeline_length()/1e3-i);n++)t.push(1)}console.log("sines",n);let o=0;for(let e=0;e<t.length;e++)o+=t[e];console.log("timeline made length: ",t.length,o),e.update_timeline(t)}(e),console.log("Made timeline"),e.generate_electric_fields(),console.log("Updated electrodes & generated electric fields"),l.electric_fields_calculated=!0,d(e)}),document.getElementById("SIMION_SAVE").addEventListener("click",t=>{e.generate_electrodes();let n=e.save_simion_pa();var o=new Blob([n],{type:"octet/stream"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(o,"electrodes.pa");else{let e=document.createElement("a"),t=URL.createObjectURL(o);e.href=t,e.download="electrodes.pa",document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e),window.URL.revokeObjectURL(t)}),0)}}),document.getElementById("field_lines").addEventListener("click",t=>{!function(e){const t=electric_field_map.getContext("2d"),n=e.efpix(),o=e.width()*h,l=e.height()*h;for(let e=1;e<o-5;e+=5)for(let c=1;c<l-5;c+=5){let l=c*(o/3)+e;t.beginPath();let r=n[l+1],i=n[l-1],d=n[l+o],a=i-r,s=n[l-o]-d,f=Math.sqrt(a*a+s*s)/8,u=a/f,_=s/f;t.strokeStyle="#000";let m=e*h,g=c*h,b=m+u,p=g+_;t.moveTo(m,g),t.lineTo(b,p),t.stroke(),t.fill}}(e)}),document.getElementById("ion_mass").addEventListener("input",e=>{l.current_mass=document.getElementById("ion_mass").value}),document.getElementById("ion_charge").addEventListener("input",e=>{l.current_charge=document.getElementById("ion_charge").value}),document.getElementById("ion_x_velocity").addEventListener("input",e=>{l.current_x_velocity=document.getElementById("ion_x_velocity").value}),document.getElementById("ion_y_velocity").addEventListener("input",e=>{l.current_y_velocity=document.getElementById("ion_y_velocity").value}),document.getElementById("randomness").addEventListener("input",e=>{l.current_random=document.getElementById("randomness").value}),document.getElementById("number").addEventListener("input",e=>{l.current_number=document.getElementById("number").value}),document.getElementById("apply_sine").addEventListener("click",()=>u("sine")),document.getElementById("apply_high").addEventListener("click",()=>u("high")),document.getElementById("apply_low").addEventListener("click",()=>u("low"))}const m=document.getElementById("electrode_map"),g=document.getElementById("electric_field_map"),b=document.getElementById("time_line"),h=3,p="#A5D6A7",v="#FFE082",y="#1976D2",E=4e5;function B(e){document.getElementById("electrode1").innerHTML=`Red</br>Electrode</br>${l.electrode_volts[1]} V`,document.getElementById("electrode2").innerHTML=`Green</br>Electrode</br>${l.electrode_volts[2]} V`,document.getElementById("electrode3").innerHTML=`Blue</br>Electrode</br>${l.electrode_volts[3]} V`,document.getElementById("electrode4").innerHTML=`Brown</br>Electrode</br>${l.electrode_volts[4]} V`,l.emap_altered&&(l.emap_altered=!1,r(e)),l.mouse_on_electrode_map&&l.no_lines&&function(e){const t=e.scale(),n=h*t,c=m.getContext("2d"),r=m.getBoundingClientRect();let i=l.mouse_electrode_map_x-r.left,d=l.mouse_electrode_map_y-r.top;i=Math.floor(i/(2*h)),d=Math.floor(d/(2*h)),c.fillStyle=o[l.active_electrode],l.brush_size<3?c.fillRect(i*n,d*n,n*l.brush_size,n*l.brush_size):c.fillRect((i-1)*n,(d-1)*n,n*l.brush_size,n*l.brush_size),l.emap_altered=!0}(e)}!async function(){const e=new((await n.e(1).then(n.bind(null,4)).catch(console.error)).Environment)(200,200,2,l.electrode_volts,E);!function(e){var t=document.getElementsByClassName("collapsible");for(let e=0;e<t.length;e++)t[e].addEventListener("click",(function(){this.classList.toggle("active");var e=this.nextElementSibling;"block"===e.style.display?e.style.display="none":e.style.display="block"}));document.getElementById("playground").click(),document.getElementById("playground").click(),document.getElementById("advanced").click(),document.getElementById("advanced").click(),b.addEventListener("click",e=>{let t=b.width;const n=b.getBoundingClientRect();let o=e.clientX-n.left;l.time_toggle?(l.time_first=Math.round(o/t*400)/400,l.time_toggle=!1):(l.time_second=Math.round(o/t*400)/400,l.time_toggle=!0),f(b)}),b.addEventListener("mousemove",e=>{const t=b.getBoundingClientRect();let n=b.width,o=e.clientX-t.left;o=Math.round(o/n*400),document.getElementById("status").innerHTML=o+" ns"})}(),function(e){electric_field_map.addEventListener("click",t=>{if(l.electric_fields_calculated){l.no_lines=!1;const n=electric_field_map.getBoundingClientRect();let o=t.clientX-n.left,c=t.clientY-n.top;o/=h,c/=h;for(let t=0;t<l.current_number;t++){let t=0,n=0,r=0,i=0;l.current_number>1&&(t=l.current_random*Math.random()-50,n=l.current_random*Math.random()-50,r=l.current_random*Math.random()-50,i=l.current_random*Math.random()-50);let d=o+.001+t/10,f=c+.001+n/10,u=l.current_x_velocity+.001+r/50,_=l.current_y_velocity-.001+i/50,g=l.current_mass,b=l.current_charge;console.log(d,f,u,_,l.current_mass,l.current_charge),l.latest_ion=[d,f,u,_,g,b],l.latest_ion_path=e.fly_ion(l.latest_ion),s(electric_field_map),s(m);let h=l.latest_ion_path.length,p="Splat!";h/3>=4e5&&(p="Timeout!"),d=d.toFixed(0),f=f.toFixed(0),u=u.toFixed(1),_=_.toFixed(1),a(`${p} ${(1e3*l.latest_ion_path[h-3]).toFixed(1)}µs ${g/b}mz (${d}, ${f}) to (${l.latest_ion_path[h-2].toFixed(0)}, ${e.height()-l.latest_ion_path[h-1].toFixed(0)-1}) at (${u}, ${_}) with ${h/3-1} steps`)}}else e.update_voltages(l.electrode_volts),console.log("Updated voltages "+l.electrode_volts),e.generate_electric_fields(),console.log("Updated electrodes & generated electric fields"),l.electric_fields_calculated=!0,d(e)}),electric_field_map.addEventListener("mousemove",t=>{const n=electric_field_map.getBoundingClientRect();let o=t.clientX-n.left,l=t.clientY-n.top;if(o=Math.floor(o/h),l=Math.floor(l/h),o>=0&&l>=0){let t=e.getef(o,l);o=(""+o).padStart(3," "),l=(""+(e.height()-l-1)).padStart(3," "),t=(""+t.toFixed(2)).padStart(5," "),document.getElementById("status").innerHTML=`x: ${o} y: ${l}\nvolts: ${t}`}})}(e),function(e){m.addEventListener("mousedown",e=>{l.emap_altered=!0,l.dragging=!0}),m.addEventListener("mouseup",e=>{l.emap_altered=!0,l.dragging=!1}),m.addEventListener("click",t=>i(t,e)),m.addEventListener("mousemove",t=>{const n=m.getBoundingClientRect();let o=Math.floor((t.clientX-n.left)/h),l=e.height()-Math.floor((t.clientY-n.top)/h)-1;document.getElementById("status").innerHTML=`x: ${o} y: ${l}`,i(t,e)}),m.addEventListener("mouseover",e=>{l.mouse_on_electrode_map=!0}),m.addEventListener("mouseout",e=>{l.mouse_on_electrode_map=!1})}(e),_(e),r(e),d(e),f(b),setInterval(B.bind(null,e,m),40)}()}]);