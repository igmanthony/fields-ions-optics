!function(e){function t(t){for(var n,r,a=t[0],l=t[1],i=0,c=[];i<a.length;i++)r=a[i],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&c.push(o[r][0]),o[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(s&&s(t);c.length;)c.shift()()}var n={},o={14:0};var r={};var a={18:function(){return{"./index_bg.js":{__wbindgen_throw:function(e,t){return n[17].exports.b(e,t)}}}}};function l(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,l),o.l=!0,o.exports}l.e=function(e){var t=[],n=o[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise((function(t,r){n=o[e]=[t,r]}));t.push(n[2]=i);var c,d=document.createElement("script");d.charset="utf-8",d.timeout=120,l.nc&&d.setAttribute("nonce",l.nc),d.src=function(e){return l.p+""+({}[e]||e)+".js"}(e);var s=new Error;c=function(t){d.onerror=d.onload=null,clearTimeout(f);var n=o[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;s.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",s.name="ChunkLoadError",s.type=r,s.request=a,n[1](s)}o[e]=void 0}};var f=setTimeout((function(){c({type:"timeout",target:d})}),12e4);d.onerror=d.onload=c,document.head.appendChild(d)}return({15:[18]}[e]||[]).forEach((function(e){var n=r[e];if(n)t.push(n);else{var o,i=a[e](),c=fetch(l.p+""+{18:"28a736229768cc3a3c69"}[e]+".module.wasm");if(i instanceof Promise&&"function"==typeof WebAssembly.compileStreaming)o=Promise.all([WebAssembly.compileStreaming(c),i]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"==typeof WebAssembly.instantiateStreaming)o=WebAssembly.instantiateStreaming(c,i);else{o=c.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,i)}))}t.push(r[e]=o.then((function(t){return l.w[e]=(t.instance||t).exports})))}})),Promise.all(t)},l.m=e,l.c=n,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)l.d(n,o,function(t){return e[t]}.bind(null,o));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="",l.oe=function(e){throw console.error(e),e},l.w={};var i=window.webpackJsonp=window.webpackJsonp||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var d=0;d<i.length;d++)t(i[d]);var s=c;l(l.s=16)}({14:function(e,t,n){var o={"./alternate_lens_map.json":[0,0],"./clear_map.json":[1,1],"./cyclotron_map.json":[2,2],"./earnshaw_map.json":[3,3],"./electric_valley_map.json":[4,4],"./funnel_map.json":[5,5],"./kingdon_trap_map.json":[6,6],"./lens_map.json":[7,7],"./magnet_test_map.json":[8,8],"./multi_reflectron_map.json":[9,9],"./quadrupole_map.json":[10,10],"./sector_nier_johnson_map.json":[11,11],"./tof2_map.json":[12,12],"./tof_map.json":[13,13]};function r(e){if(!n.o(o,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=o[e],r=t[0];return n.e(t[1]).then((function(){return n.t(r,3)}))}r.keys=function(){return Object.keys(o)},r.id=14,e.exports=r},15:function(e,t,n){var o={"./alternate_lens_map.json":[0,0],"./clear_map.json":[1,1],"./cyclotron_map.json":[2,2],"./earnshaw_map.json":[3,3],"./electric_valley_map.json":[4,4],"./funnel_map.json":[5,5],"./kingdon_trap_map.json":[6,6],"./lens_map.json":[7,7],"./magnet_test_map.json":[8,8],"./multi_reflectron_map.json":[9,9],"./quadrupole_map.json":[10,10],"./sector_nier_johnson_map.json":[11,11],"./tof2_map.json":[12,12],"./tof_map.json":[13,13]};function r(e){if(!n.o(o,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=o[e],r=t[0];return n.e(t[1]).then((function(){return n.t(r,3)}))}r.keys=function(){return Object.keys(o)},r.id=15,e.exports=r},16:function(e,t,n){"use strict";n.r(t);let o={active_electrode:1,emap_altered:!1,dragging:!1,dragging_frame:0,initial_click:[-1,-1],brush:1,electric_fields_calculated:!1,voltages_were_updated:!1,latest_ion_path:[],latest_ion:[],mouse_on_electrode_map:!1,previous_mouse_electrode_position_x:-1,previous_mouse_electrode_position_y:-1,previous_mouse_electrode_position_x2:-1,previous_mouse_electrode_position_y2:-1,mouse_electrode_map_x:0,mouse_electrode_map_y:0,mouse_ef_map_x:0,mouse_ef_map_y:0,delta_ef_map_x:0,delta_ef_map_y:0,no_lines:!0,splatlog:[],to_apply:[],rect:[0,0],cellSize:3,scale:2,canvas_height:600,canvas_width:600,map_width:200,map_height:200,history1:0,history2:0,history3:Array(1e4).fill(0),three_dimension_view:0,efmap_altered:0,gl:null,programInfo:null,bufferInfo:null,three_d_zoom_level:0,efmap_pixels:null,fake_canvas:null,refresh_canvas:1},r={electrode_volts:[0,500,1e3,-500,-1e3],splattable:[-1,0,0,0,0],dc_only:[1,1,1,1,1],magnet_mode:[0,0,0,0,0],pulse_starts:[0,0,0,0,0],pulse_ends:[0,1e6,1e6,1e6,1e6],electrode_frequencies:[0,1600,1600,1600,1600],electrode_offsets:[0,0,0,0,0],background_gas_mass:28,pressure:0,current_mz:100,current_x_position:0,current_y_position:0,current_x_velocity:0,current_y_velocity:0,random_ke:0,max_time:1e6,fdm_accuracy:10};const a=["#30123b","#311542","#32184a","#341b51","#351e58","#36215f","#372365","#38266c","#392972","#3a2c79","#3b2f7f","#3c3285","#3c358b","#3d3791","#3e3a96","#3f3d9c","#4040a1","#4043a6","#4145ab","#4148b0","#424bb5","#434eba","#4350be","#4353c2","#4456c7","#4458cb","#455bce","#455ed2","#4560d6","#4563d9","#4666dd","#4668e0","#466be3","#466de6","#4670e8","#4673eb","#4675ed","#4678f0","#467af2","#467df4","#467ff6","#4682f8","#4584f9","#4587fb","#4589fc","#448cfd","#438efd","#4291fe","#4193fe","#4096fe","#3f98fe","#3e9bfe","#3c9dfd","#3ba0fc","#39a2fc","#38a5fb","#36a8f9","#34aaf8","#33acf6","#31aff5","#2fb1f3","#2db4f1","#2bb6ef","#2ab9ed","#28bbeb","#26bde9","#25c0e6","#23c2e4","#21c4e1","#20c6df","#1ec9dc","#1dcbda","#1ccdd7","#1bcfd4","#1ad1d2","#19d3cf","#18d5cc","#18d7ca","#17d9c7","#17dac4","#17dcc2","#17debf","#18e0bd","#18e1ba","#19e3b8","#1ae4b6","#1be5b4","#1de7b1","#1ee8af","#20e9ac","#22eba9","#24eca6","#27eda3","#29eea0","#2cef9d","#2ff09a","#32f197","#35f394","#38f491","#3bf48d","#3ff58a","#42f687","#46f783","#4af880","#4df97c","#51f979","#55fa76","#59fb72","#5dfb6f","#61fc6c","#65fc68","#69fd65","#6dfd62","#71fd5f","#74fe5c","#78fe59","#7cfe56","#80fe53","#84fe50","#87fe4d","#8bfe4b","#8efe48","#92fe46","#95fe44","#98fe42","#9bfd40","#9efd3e","#a1fc3d","#a4fc3b","#a6fb3a","#a9fb39","#acfa37","#aef937","#b1f836","#b3f835","#b6f735","#b9f534","#bbf434","#bef334","#c0f233","#c3f133","#c5ef33","#c8ee33","#caed33","#cdeb34","#cfea34","#d1e834","#d4e735","#d6e535","#d8e335","#dae236","#dde036","#dfde36","#e1dc37","#e3da37","#e5d838","#e7d738","#e8d538","#ead339","#ecd139","#edcf39","#efcd39","#f0cb3a","#f2c83a","#f3c63a","#f4c43a","#f6c23a","#f7c039","#f8be39","#f9bc39","#f9ba38","#fab737","#fbb537","#fbb336","#fcb035","#fcae34","#fdab33","#fda932","#fda631","#fda330","#fea12f","#fe9e2e","#fe9b2d","#fe982c","#fd952b","#fd9229","#fd8f28","#fd8c27","#fc8926","#fc8624","#fb8323","#fb8022","#fa7d20","#fa7a1f","#f9771e","#f8741c","#f7711b","#f76e1a","#f66b18","#f56817","#f46516","#f36315","#f26014","#f15d13","#ef5a11","#ee5810","#ed550f","#ec520e","#ea500d","#e94d0d","#e84b0c","#e6490b","#e5460a","#e3440a","#e24209","#e04008","#de3e08","#dd3c07","#db3a07","#d93806","#d73606","#d63405","#d43205","#d23005","#d02f04","#ce2d04","#cb2b03","#c92903","#c72803","#c52602","#c32402","#c02302","#be2102","#bb1f01","#b91e01","#b61c01","#b41b01","#b11901","#ae1801","#ac1601","#a91501","#a61401","#a31201","#a01101","#9d1001","#9a0e01","#970d01","#940c01","#910b01","#8e0a01","#8b0901","#870801","#840701","#810602","#7d0502","#7a0402"],l=["#ffffff","#f44336","#4CAF50","#2196F3","#795548"],i=["#ffffff","#FFCDD2","#C8E6C9","#BBDEFB","#D7CCC8"],c=["#ffffff","#E57373","#81C784","#64B5F6","#A1887F"];function d(e){const t=o.scale,n=e.width()/t,a=e.height()/t,c=o.cellSize*t,d=e.electrode_pixels();const s=document.getElementById("electrode_map").getContext("2d");for(let e=0;e<n;e++)for(let t=0;t<a;t++){const o=d[t*n+e];if(1==r.magnet_mode[o]&&o>0){if(s.fillStyle=i[o],s.fillRect(e*c,t*c,c,c),e%3==0&&t%3==0)if(s.fillStyle=l[o],r.electrode_volts[o]>0)for(let n=0;n<c;n++)s.fillRect(e*c+n,t*c+n,1,1),s.fillRect(e*c-n+(c-1),t*c+n,1,1);else s.fillRect(e*c+2,t*c+2,2,2)}else 1==r.splattable[o]&&o>0?(s.fillStyle=l[0],s.fillRect(e*c,t*c,c,c),s.fillStyle=i[o],s.fillRect(e*c+2,t*c+2,2,2)):(s.fillStyle=l[o],s.fillRect(e*c,t*c,c,c))}}function s(e,t,n,o){let r=[],a=n-e,l=o-t,i=Math.max(Math.abs(a),Math.abs(l));for(let a=0;a<=i;a++){let l=0===i?0:a/i,c=e+l*(n-e),d=t+l*(o-t);r.push([Math.round(c),Math.round(d)])}return r}function f(e,t,n,o){let r=s(e,t,n,t),a=s(e,o,n,o);return[...r,...s(e,t,e,o),...s(n,t,n,o),...a]}function u(e,t,n,o){let r=Math.abs(e-n)+e,a=Math.abs(t-o)+t,l=(Math.abs(e-n),Math.abs(t-o),Math.abs(r-e)),i=Math.abs(a-t),c=[];for(let n=t-a;n<t+a;n++){for(let o=e-r;o<e+r;o++)(o-e)*(o-e)/(l*l)+(n-t)*(n-t)/(i*i)<=1&&(o-e)*(o-e)/((l-1)*(l-1))+(n-t)*(n-t)/((i-1)*(i-1))>1&&c.push([Math.round(o),Math.round(n)])}return c}function m(e){o.history1=o.history2,o.history2=o.history3,o.history3=e.electrode_pixels()}function _(e,t){if(o.dragging)o.to_apply.push([o.mouse_electrode_map_x,o.mouse_electrode_map_y]);else if("click"==e.type){o.no_lines=!0;const e=document.getElementById("electrode_map").getBoundingClientRect();let n=o.mouse_electrode_map_x-e.left,r=o.mouse_electrode_map_y-e.top;if(o.emap_altered=!0,n=Math.round(n/(2*o.cellSize)-.65),r=Math.round(r/(2*o.cellSize)-.65),n<0||r<0)return;if(1==o.brush)o.previous_mouse_electrode_position_x==n&&o.previous_mouse_electrode_position_y==r||(t.brush(n,r,o.active_electrode),o.previous_mouse_electrode_position_x=n,o.previous_mouse_electrode_position_y=r);else if(2!=o.brush||o.dragging)if(3!=o.brush||o.dragging)if(4!=o.brush||o.dragging){if(5==o.brush&&!o.dragging){const e=o.scale,a=t.width()/e,l=t.height()/e;let i=function(e,t,n,o,r){let a=[],l=n[t*o+e],i=[];for(i.push([e,t]);0!=i.length;){let e=i.pop(),t=e[1],c=e[0];if(n[t*o+c]==l){a.push(t*o+c);for(let e of[[c+1,t],[c-1,t],[c,t+1],[c,t-1]])0<=e[0]&&e[0]<=o-1&&0<=e[1]&&e[1]<=r-1&&(a.includes(e[1]*o+e[0])||i.push(e))}}return a}(n,r,t.electrode_pixels(),a,l);for(let e of i)t.brush(e%a,Math.floor(e/a),o.active_electrode)}}else{let e=f(Math.floor(o.initial_click[0]/(2*o.cellSize)),Math.floor(o.initial_click[1]/(2*o.cellSize)),n,r);for(let n of e)t.brush(n[0],n[1],o.active_electrode)}else{let e=u(Math.floor(o.initial_click[0]/(2*o.cellSize)),Math.floor(o.initial_click[1]/(2*o.cellSize)),n,r);for(let n of e)t.brush(n[0],n[1],o.active_electrode)}else{let e=s(Math.floor(o.initial_click[0]/(2*o.cellSize)),Math.floor(o.initial_click[1]/(2*o.cellSize)),n,r);for(let n of e)t.brush(n[0],n[1],o.active_electrode)}m(t)}}function p(e){electrode_map.addEventListener("mousedown",e=>{o.emap_altered=!0,o.dragging=!0}),electrode_map.addEventListener("mouseup",t=>{if(o.emap_altered=!0,o.dragging=!1,1==o.brush){const t=electrode_map.getBoundingClientRect();for(let n of o.to_apply){let r=n[0]-t.left,a=n[1]-t.top;r=Math.round(r/(2*o.cellSize)-.65),a=Math.round(a/(2*o.cellSize)-.65),e.brush(r,a,o.active_electrode)}o.to_apply=[]}}),electrode_map.addEventListener("click",t=>{if(1==o.brush||5==o.brush)_(t,e);else if(-1==o.initial_click[0]&&-1==o.initial_click[1]){const e=electrode_map.getBoundingClientRect();o.initial_click[0]=t.clientX-e.left,o.initial_click[1]=t.clientY-e.top}else _(t,e),o.initial_click[0]=-1,o.initial_click[1]=-1}),electrode_map.addEventListener("mousemove",t=>{const n=electrode_map.getBoundingClientRect(),r=o.cellSize*o.scale;o.rect=[n.left,n.top];let a=Math.floor((t.clientX-n.left)/o.cellSize),i=e.height()-Math.floor((t.clientY-n.top)/o.cellSize)-1;if(document.getElementById("status").innerHTML=`x: ${a} y: ${i}`,o.mouse_electrode_map_x=t.clientX,o.mouse_electrode_map_y=t.clientY,_(t,e),o.dragging&&1==o.brush){const e=electrode_map.getContext("2d");e.fillStyle=l[o.active_electrode];for(let t of o.to_apply){let a=t[0]-n.left,l=t[1]-n.top;a=Math.round(a/(2*o.cellSize)-.65),l=Math.round(l/(2*o.cellSize)-.65),e.fillRect(a*r,l*r,r,r)}}}),electrode_map.addEventListener("mouseover",e=>{o.mouse_on_electrode_map=!0}),electrode_map.addEventListener("mouseout",t=>{if(o.mouse_on_electrode_map=!1,o.dragging=!1,o.initial_click=[-1,-1],1==o.brush){const t=electrode_map.getBoundingClientRect();for(let n of o.to_apply){let r=n[0]-t.left,a=n[1]-t.top;r=Math.round(r/(2*o.cellSize)-.65),a=Math.round(a/(2*o.cellSize)-.65),e.brush(r,a,o.active_electrode)}o.to_apply=[]}d(e)})}function g(e,t,n){return(n=n||new Float32Array(3))[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function y(e,t){t=t||new Float32Array(3);var n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return n>1e-5&&(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n),t}function h(e,t,n){return(n=n||new Float32Array(3))[0]=e[1]*t[2]-e[2]*t[1],n[1]=e[2]*t[0]-e[0]*t[2],n[2]=e[0]*t[1]-e[1]*t[0],n}var b={lookAt:function(e,t,n,o){o=o||new Float32Array(16);var r=y(g(e,t)),a=y(h(n,r)),l=y(h(r,a));return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=0,o[4]=l[0],o[5]=l[1],o[6]=l[2],o[7]=0,o[8]=r[0],o[9]=r[1],o[10]=r[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o},xRotate:function(e,t,n){n=n||new Float32Array(16);var o=e[4],r=e[5],a=e[6],l=e[7],i=e[8],c=e[9],d=e[10],s=e[11],f=Math.cos(t),u=Math.sin(t);return n[4]=f*o+u*i,n[5]=f*r+u*c,n[6]=f*a+u*d,n[7]=f*l+u*s,n[8]=f*i-u*o,n[9]=f*c-u*r,n[10]=f*d-u*a,n[11]=f*s-u*l,e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},yRotate:function(e,t,n){n=n||new Float32Array(16);var o=e[0],r=e[1],a=e[2],l=e[3],i=e[8],c=e[9],d=e[10],s=e[11],f=Math.cos(t),u=Math.sin(t);return n[0]=f*o-u*i,n[1]=f*r-u*c,n[2]=f*a-u*d,n[3]=f*l-u*s,n[8]=f*i+u*o,n[9]=f*c+u*r,n[10]=f*d+u*a,n[11]=f*s+u*l,e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},perspective:function(e,t,n,o,r){r=r||new Float32Array(16);var a=Math.tan(.5*Math.PI-.5*e),l=1/(n-o);return r[0]=a/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=(n+o)*l,r[11]=-1,r[12]=0,r[13]=0,r[14]=n*o*l*2,r[15]=0,r},inverse:function(e,t){t=t||new Float32Array(16);var n=e[0],o=e[1],r=e[2],a=e[3],l=e[4],i=e[5],c=e[6],d=e[7],s=e[8],f=e[9],u=e[10],m=e[11],_=e[12],p=e[13],g=e[14],y=e[15],h=u*y,b=g*m,v=c*y,E=g*d,B=c*m,I=u*d,x=r*y,k=g*a,w=r*m,S=u*a,A=r*d,M=c*a,z=s*p,L=_*f,T=l*p,F=_*i,R=l*f,C=s*i,j=n*p,O=_*o,P=n*f,U=s*o,$=n*i,D=l*o,N=h*i+E*f+B*p-(b*i+v*f+I*p),V=b*o+x*f+S*p-(h*o+k*f+w*p),q=v*o+k*i+A*p-(E*o+x*i+M*p),W=I*o+w*i+M*f-(B*o+S*i+A*f),X=1/(n*N+l*V+s*q+_*W);return t[0]=X*N,t[1]=X*V,t[2]=X*q,t[3]=X*W,t[4]=X*(b*l+v*s+I*_-(h*l+E*s+B*_)),t[5]=X*(h*n+k*s+w*_-(b*n+x*s+S*_)),t[6]=X*(E*n+x*l+M*_-(v*n+k*l+A*_)),t[7]=X*(B*n+S*l+A*s-(I*n+w*l+M*s)),t[8]=X*(z*d+F*m+R*y-(L*d+T*m+C*y)),t[9]=X*(L*a+j*m+U*y-(z*a+O*m+P*y)),t[10]=X*(T*a+O*d+$*y-(F*a+j*d+D*y)),t[11]=X*(C*a+P*d+D*m-(R*a+U*d+$*m)),t[12]=X*(T*u+C*g+L*c-(R*g+z*c+F*u)),t[13]=X*(P*g+z*r+O*u-(j*u+U*g+L*r)),t[14]=X*(j*c+D*g+F*r-($*g+T*r+O*c)),t[15]=X*($*u+R*r+U*c-(P*c+D*u+C*r)),t},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},cross:h,normalize:y,subtractVectors:g,translate:function(e,t,n,o,r){r=r||new Float32Array(16);var a=e[0],l=e[1],i=e[2],c=e[3],d=e[4],s=e[5],f=e[6],u=e[7],m=e[8],_=e[9],p=e[10],g=e[11],y=e[12],h=e[13],b=e[14],v=e[15];return e!==r&&(r[0]=a,r[1]=l,r[2]=i,r[3]=c,r[4]=d,r[5]=s,r[6]=f,r[7]=u,r[8]=m,r[9]=_,r[10]=p,r[11]=g),r[12]=a*t+d*n+m*o+y,r[13]=l*t+s*n+_*o+h,r[14]=i*t+f*n+p*o+b,r[15]=c*t+u*n+g*o+v,r}};const v=["VERTEX_SHADER","FRAGMENT_SHADER"],E=/^[ \t]*\n/,B=/(\.|\[|]|\w+)/g,I=/coord|texture/i,x={},k="";function w(e,t){return function(n){if(n.value)switch(e.disableVertexAttribArray(t),n.value.length){case 4:e.vertexAttrib4fv(t,n.value);break;case 3:e.vertexAttrib3fv(t,n.value);break;case 2:e.vertexAttrib2fv(t,n.value);break;case 1:e.vertexAttrib1fv(t,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(34962,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,n.numComponents||n.size,n.type||5126,n.normalize||!1,n.stride||0,n.offset||0),void 0!==n.divisor&&e.vertexAttribDivisor(t,n.divisor)}}const S={};function A(e,t,n,o){const r=e.split(B).filter(e=>""!==e);let a=0,l="";for(;;){const e=r[a++];l+=e;const i=e[0]>="0"&&e[0]<="9",c=i?parseInt(e):e;i&&(l+=r[a++]);if(a===r.length){n[c]=t;break}{const e=r[a++],t="["===e,i=n[c]||(t?[]:{});n[c]=i,n=i,o[l]=o[l]||function(e){return function(t){setUniformTree(e,t)}}(i),l+=e}}}function M(...e){console.error(...e)}function z(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}function L(e,t){const n={program:t,uniformSetters:function(e,t){let n=0;function o(t,o,r){const a=o.name.endsWith("[0]"),l=o.type,i=x[l];if(!i)throw new Error("unknown type: 0x"+l.toString(16));let c;if(i.bindPoint){const t=n;n+=o.size,c=a?i.arraySetter(e,l,t,r,o.size):i.setter(e,l,t,r,o.size)}else c=i.arraySetter&&a?i.arraySetter(e,r):i.setter(e,r);return c.location=r,c}const r={},a={},l=e.getProgramParameter(t,35718);for(let n=0;n<l;++n){const l=e.getActiveUniform(t,n);if(z(l))continue;let i=l.name;i.endsWith("[0]")&&(i=i.substr(0,i.length-3));const c=e.getUniformLocation(t,l.name);if(c){const e=o(0,l,c);r[i]=e,A(i,e,a,r)}}return r}(e,t),attribSetters:function(e,t){const n={},o=e.getProgramParameter(t,35721);for(let r=0;r<o;++r){const o=e.getActiveAttrib(t,r);if(z(o))continue;const a=e.getAttribLocation(t,o.name),l=S[o.type],i=l.setter(e,a,l);i.location=a,n[o.name]=i}return n}(e,t)};return e.texStorage2D&&(n.uniformBlockSpec=function(e,t){const n=e.getProgramParameter(t,35718),o=[],r=[];for(let a=0;a<n;++a){r.push(a),o.push({});const n=e.getActiveUniform(t,a);o[a].name=n.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach((function(n){const a=n[0],l=n[1];e.getActiveUniforms(t,r,e[a]).forEach((function(e,t){o[t][l]=e}))}));const a={},l=e.getProgramParameter(t,35382);for(let n=0;n<l;++n){const o=e.getActiveUniformBlockName(t,n),r={index:e.getUniformBlockIndex(t,o),usedByVertexShader:e.getActiveUniformBlockParameter(t,n,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),usedByFragmentShader:e.getActiveUniformBlockParameter(t,n,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),size:e.getActiveUniformBlockParameter(t,n,UNIFORM_BLOCK_DATA_SIZE),uniformIndices:e.getActiveUniformBlockParameter(t,n,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)};r.used=r.usedByVertexShader||r.usedByFragmentShader,a[o]=r}return{blockSpecs:a,uniformData:o}}(e,t),n.transformFeedbackInfo=function(e,t){const n={},o=e.getProgramParameter(t,35971);for(let r=0;r<o;++r){const o=e.getTransformFeedbackVarying(t,r);n[o.name]={index:r,type:o.type,size:o.size}}return n}(e,t)),n}function T(e,t,n,o,r){const a=R(n,o,r);let l=!0;if(t=t.map((function(e){if(e.indexOf("\n")<0){const t=getElementById(e);t?e=t.text:(a.errorCallback("no element with id: "+e),l=!1)}return e})),!l)return null;const i=function(e,t,n,o,r){const a=R(n,o,r),l=[];for(let n=0;n<t.length;++n){const o=F(e,t[n],e[v[n]],a.errorCallback);if(!o)return null;l.push(o)}return function(e,t,n,o,r){const a=R(n,o,r),l=[],i=[];for(let n=0;n<t.length;++n){let o=t[n];if("string"==typeof o){const t=getElementById(o),r=t?t.text:o;let l=e[v[n]];t&&t.type&&(l=getShaderTypeFromScriptType(e,t.type)||l),o=F(e,r,l,a.errorCallback),i.push(o)}"undefined"!=typeof WebGLShader&&o instanceof WebGLShader&&l.push(o)}if(l.length!==t.length)return a.errorCallback("not enough shaders for program"),deleteShaders(e,i),null;const c=e.createProgram();l.forEach((function(t){e.attachShader(c,t)})),a.attribLocations&&Object.keys(a.attribLocations).forEach((function(t){e.bindAttribLocation(c,a.attribLocations[t],t)}));let d=a.transformFeedbackVaryings;d&&(d.attribs&&(d=d.attribs),Array.isArray(d)||(d=Object.keys(d)),e.transformFeedbackVaryings(c,d,a.transformFeedbackMode||SEPARATE_ATTRIBS));e.linkProgram(c);if(!e.getProgramParameter(c,35714)){const t=e.getProgramInfoLog(c);return a.errorCallback(`${l.map(t=>{const n=addLineNumbersWithError(e.getShaderSource(t),"",0),o=e.getShaderParameter(t,e.SHADER_TYPE);return`${$(e,o)}\n${n}}`}).join("\n")}\nError in program linking: ${t}`),e.deleteProgram(c),deleteShaders(e,i),null}return c}(e,l,a)}(e,t,a);return i?L(e,i):null}function F(e,t,n,o){const r=o||M,a=e.createShader(n);let l=0;E.test(t)&&(l=1,t=t.replace(E,"")),e.shaderSource(a,t),e.compileShader(a);if(!e.getShaderParameter(a,35713)){const o=e.getShaderInfoLog(a);return r(`${addLineNumbersWithError(t,o,l)}\nError compiling ${$(e,n)}: ${o}`),e.deleteShader(a),null}return a}function R(e,t,n){let o,r;if("function"==typeof t&&(n=t,t=void 0),"function"==typeof e)n=e,e=void 0;else if(e&&!Array.isArray(e)){if(e.errorCallback)return e;const t=e;n=t.errorCallback,e=t.attribLocations,o=t.transformFeedbackVaryings,r=t.transformFeedbackMode}const a={errorCallback:n||M,transformFeedbackVaryings:o,transformFeedbackMode:r};if(e){let n={};Array.isArray(e)?e.forEach((function(e,o){n[e]=t?t[o]:o})):n=e,a.attribLocations=n}return a}function C(e,t,n){const o=function(e,t){const n={};return Object.keys(t).forEach((function(o){if("indices"!==o){const r=t[o],a=r.attrib||r.name||r.attribName||k+o;if(r.value){if(!Array.isArray(r.value)&&!P(r.value))throw new Error("array.value is not array or typedarray");n[a]={value:r.value}}else{let t,l,i,c;if(r.buffer&&r.buffer instanceof WebGLBuffer)t=r.buffer,c=r.numComponents||r.size,l=r.type,i=r.normalize;else if("number"==typeof r||"number"==typeof r.data){const n=r.data||r,a=r.type||Float32Array,d=n*a.BYTES_PER_ELEMENT;l=getGLTypeForTypedArrayType(a),i=void 0!==r.normalize?r.normalize:getNormalizationForTypedArrayType(a),c=r.numComponents||r.size||D(o,n),t=e.createBuffer(),e.bindBuffer(34962,t),e.bufferData(34962,d,r.drawType||35044)}else{const n=U(r,o);t=j(e,n,void 0,r.drawType),l=O(n),i=void 0!==r.normalize?r.normalize:function(e){return e instanceof Int8Array||e instanceof Uint8Array}(n),c=function(e,t){return e.numComponents||e.size||D(t,(e.length?e:e.data).length)}(r,o)}n[a]={buffer:t,numComponents:c,type:l,normalize:i,stride:r.stride||0,offset:r.offset||0,divisor:void 0===r.divisor?void 0:r.divisor,drawType:r.drawType}}}})),e.bindBuffer(34962,null),n}(e,t),r=Object.assign({},n||{});r.attribs=Object.assign({},n?n.attribs:{},o);const a=t.indices;if(a){const t=U(a,"indices");r.indices=j(e,t,34963),r.numElements=t.length,r.elementType=O(t)}else r.numElements||(r.numElements=getNumElementsFromAttributes(e,r.attribs));return r}function j(e,t,n,o){n=n||34962;const r=e.createBuffer();return function(e,t,n,o,r){e.bindBuffer(t,n),e.bufferData(t,o,r||35044)}(e,n,r,t,o),r}function O(e){if(e instanceof Int8Array)return 5120;if(e instanceof Uint8Array)return 5121;if(e instanceof Uint8ClampedArray)return 5121;if(e instanceof Int16Array)return 5122;if(e instanceof Uint16Array)return 5123;if(e instanceof Int32Array)return 5124;if(e instanceof Uint32Array)return 5125;if(e instanceof Float32Array)return 5126;throw new Error("unsupported typed array type")}S[35664]={size:8,setter:w},S[35665]={size:12,setter:w},S[35666]={size:16,setter:w},S[35676]={size:16,setter:function(e,t,n){const o=n.size,r=n.count;return function(n){e.bindBuffer(34962,n.buffer);const a=n.size||n.numComponents||o,l=a/r,i=n.type||5126,c=x[i].size*a,d=n.normalize||!1,s=n.offset||0,f=c/r;for(let o=0;o<r;++o)e.enableVertexAttribArray(t+o),e.vertexAttribPointer(t+o,l,i,d,c,s+f*o),void 0!==n.divisor&&e.vertexAttribDivisor(t+o,n.divisor)}},count:4},x[35664]={Type:Float32Array,size:8,setter:function(e,t){return function(n){e.uniform2fv(t,n)}},cols:2},x[35665]={Type:Float32Array,size:12,setter:function(e,t){return function(n){e.uniform3fv(t,n)}},cols:3},x[35666]={Type:Float32Array,size:16,setter:function(e,t){return function(n){e.uniform4fv(t,n)}},cols:4},x[35676]={Type:Float32Array,size:64,setter:function(e,t){return function(n){e.uniformMatrix4fv(t,!1,n)}},rows:4,cols:4},x[35678]={Type:null,size:0,setter:function(e,t,n,o){var r=x[t].bindPoint;return function(t){e.uniform1i(o,n),e.activeTexture(e.TEXTURE0+n),e.bindTexture(r,t)}},arraySetter:function(e,t,n,o,r){for(var a=x[t].bindPoint,l=new Int32Array(r),i=0;i<r;++i)l[i]=n+i;return function(t){e.uniform1iv(o,l),t.forEach((function(t,n){e.activeTexture(e.TEXTURE0+l[n]),e.bindTexture(a,t)}))}},bindPoint:3553};const P="undefined"!=typeof SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer};function U(e,t){if(P(e))return e;if(P(e.data))return e.data;Array.isArray(e)&&(e={data:e});let n=e.type;return n||(n="indices"===t?Uint32Array:Float32Array),new n(e.data)}const $=function(){const e={},t={};return function(n,o){return function(n){const o=n.constructor.name;if(!e[o]){for(const e in n)if("number"==typeof n[e]){const o=t[n[e]];t[n[e]]=o?`${o} | ${e}`:e}e[o]=!0}}(n),t[o]||("number"==typeof o?"0x"+o.toString(16):o)}}();function D(e,t){let n;return n=I.test(e)?2:3,n}function N(e){return e*Math.PI/180}function V(e){const t=N(2*Math.PI/180),n=e.positions,o=e.texcoords,r=e.indices,a=function(e,t){const n=[];for(let o=0;o<e.length/3;o++){const r=3*e[3*o],a=3*e[3*o+1],l=3*e[3*o+2],i=t.slice(r,r+3),c=t.slice(a,a+3),d=t.slice(l,l+3);n.push(b.normalize(b.cross(b.subtractVectors(i,c),b.subtractVectors(d,c))))}return n}(r,n),l=function(e){let t={},n=0;const o=[];for(let r=0;r<e.length;r++){const a=3*r,l=e.slice(a,a+3),i=l[0]+","+l[1]+","+l[2];void 0===t[i]&&(t[i]=n++),o.push(t[i])}return o}(n),i=function(e,t){const n=[];for(let o=0;o<t.length;++o){const r=e[t[o]];n[r]=n[r]?n[r]:[],n[r].push(Math.floor(o/3))}return n}(l,r),c=[],d=[],s=[],f=[];let u={},m=0;const _=Math.cos(t);for(let e=0;e<r.length;++e){const t=a[Math.floor(e/3)],p=r[e],g=[0,0,0];i[l[p]].forEach(e=>{const n=a[e];b.dot(t,n)>_&&(g[0]+=n[0],g[1]+=n[1],g[2]+=n[2])}),b.normalize(g,g);const y=3*p,h=2*p,v=n[y+0],E=n[y+1],B=n[y+2],I=g[0],x=g[1],k=g[2],w=o[h+0],S=o[h+1],A=`${v},${E},${B},${I},${x},${k},${w},${S}`;void 0===u[A]&&(u[A]=m++,c.push(v,E,B),s.push(I,x,k),d.push(w,S)),f.push(u[A])}return{position:c,texcoord:d,normal:s,indices:f}}function q(e){let t;o.efmap_altered||null===o.efmap_pixels?(t=e.efpix(),o.efmap_altered=0,o.efmap_pixels=t):t=o.efmap_pixels;const n=Math.max(...t),r=Math.min(...t);if(!o.fake_canvas){o.fake_canvas=document.createElement("canvas").getContext("2d"),o.fake_canvas.canvas.width=o.canvas_width,o.fake_canvas.canvas.height=o.canvas_height;for(let e=0;e<o.map_width;e++)for(let l=0;l<o.map_height;l++){let i=t[l*o.map_width+e],c=Math.floor((i-r)/(n-r)*255);o.fake_canvas.fillStyle=a[c],o.fake_canvas.fillRect(e,l,o.cellSize,o.cellSize)}o.refresh_canvas=0}const l=o.fake_canvas.getImageData(0,0,o.map_width,o.map_height),i=V(function(e,t,n,o,r){let a=e=>50*Math.floor((e-n)/(t-n)*99)/99;const l=[],i=[],c=[],d=[],s=o-1,f=r-1;for(let t=0;t<f;t++)for(let n=0;n<s;n++){if(void 0!==l[`${n},${t}`])continue;const r=i.length/3,u=t*o+n,m=u+o,_=m+o,p=a(e[u+0]),g=a(e[u+1]),y=a(e[m+0]),h=a(e[m+1]),b=n,v=t;let E=n+1,B=t+1;const I=n/s,x=t/f;let k=E/s,w=B/f;if(n<s-2&&t<f-1){const o=a(e[u+2]),r=a(e[m+2]),i=a(e[_+0]),c=a(e[_+1]),d=a(e[_+2]);p==o&&o==d&&i==o?(l[`${n+1},${t+1}`]=1,l[`${n+0},${t+1}`]=1,l[`${n+1},${t+0}`]=1,E+=1,B+=1,k=E/s,w=B/f):p==g&&o==g&&r==h&&y==h?(E+=1,k=E/s,l[`${n+1},${t+0}`]=1):p==i&&i==c&&c==g&&(B+=1,w=B/f,l[`${n+0},${t+1}`]=1)}i.push(b,p,v,E,g,v,b,y,B,E,h,B),c.push(I,x,k,x,I,w,k,w),d.push(r,r+3,r+1,r,r+2,r+3)}return{positions:i,texcoords:c,indices:d}}(t,n,r,o.map_width,o.map_height)),c=o.gl;c.clearColor(1,1,1,1),c.clear(c.COLOR_BUFFER_BIT),c.bindTexture(c.TEXTURE_2D,c.createTexture()),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,l),c.generateMipmap(c.TEXTURE_2D),o.delta_ef_map_y=0,o.delta_ef_map_x=0,o.three_d_zoom_level=0,o.programInfo=T(c,["attribute vec4 position;\nattribute vec3 normal;\nattribute vec2 texcoord;\nuniform mat4 projection;\nuniform mat4 modelView;\nvarying vec3 v_normal;\nvarying vec2 v_texcoord;\nvoid main() {\n  gl_Position = projection * modelView * position;\n  v_normal = mat3(modelView) * normal;\n  v_texcoord = texcoord;\n}\n","precision highp float;\nvarying vec3 v_normal;\nvarying vec2 v_texcoord;\nvarying float v_modelId;\nuniform sampler2D u_texture;\nvoid main() {\n  vec3 lightDirection = normalize(vec3(1, 2, -3));  // arbitrary light direction\n  float l = dot(lightDirection, normalize(v_normal)) * .5 + .5;\n  highp vec4 texelColor = texture2D(u_texture, v_texcoord);\n  gl_FragColor = vec4(texelColor.rgb * l, texelColor.a);\n}\n"]),o.bufferInfo=C(c,i),requestAnimationFrame(W)}function W(){try{const e=o.gl;o.delta_ef_map_x=Math.min(89,o.delta_ef_map_x),o.delta_ef_map_x=Math.max(0,o.delta_ef_map_x),o.gl.canvas.width=0|o.gl.canvas.clientWidth,o.gl.canvas.height=0|o.gl.canvas.clientHeight;const t=N(-o.delta_ef_map_y),n=N(-o.delta_ef_map_x),r=N(11.5),a=e.canvas.clientWidth/e.canvas.clientHeight,l=10,i=2e3,c=b.perspective(r,a,l,i),d=[0,1010+o.three_d_zoom_level,1],s=[0,0,0],f=[0,1,0],u=b.lookAt(d,s,f);let m=b.inverse(u);m=b.xRotate(m,n),m=b.yRotate(m,t),m=b.translate(m,-o.map_width/2,0,-o.map_height/2);let _=m;e.viewport(0,0,e.canvas.width,e.canvas.height),e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.useProgram(o.programInfo.program),function(e,t,n){n.vertexArrayObject?e.bindVertexArray(n.vertexArrayObject):(!function(e,t){for(const n in t){const o=e[n];o&&o(t[n])}}(t.attribSetters||t,n.attribs),n.indices&&e.bindBuffer(34963,n.indices))}(e,o.programInfo,o.bufferInfo),function e(t,...n){const o=t.uniformSetters||t,r=n.length;for(let t=0;t<r;++t){const r=n[t];if(Array.isArray(r)){const t=r.length;for(let n=0;n<t;++n)e(o,r[n])}else for(const e in r){const t=o[e];t&&t(r[e])}}}(o.programInfo,{projection:c,modelView:_});const p=0;e.drawElements(e.TRIANGLES,o.bufferInfo.numElements,e.UNSIGNED_INT,p),requestAnimationFrame(W)}catch(e){o.three_dimension_view&&(o.three_dimension_view=0)}}function X(e){const t=e.efpix();o.efmap_pixels=t;let n=document.getElementById("electric_field_map");if(o.three_dimension_view)o.gl=null===o.gl?n.getContext("webgl2"):o.gl,q(e);else{const e=n.getContext("2d"),r=Math.max(...t),l=Math.min(...t);for(let n=0;n<o.map_width;n++)for(let i=0;i<o.map_height;i++){let c=t[i*o.map_width+n];e.fillStyle=a[Math.floor((c-l)/(r-l)*255)],e.fillRect(n*o.cellSize,i*o.cellSize,o.cellSize,o.cellSize)}}}function H(e){let t=document.getElementById("electric_field_map");o.three_d_zoom_level=0,o.three_dimension_view?(t.addEventListener("click",e=>{Y(e,t)}),t.addEventListener("mousemove",e=>{if(o.dragging){let t=o.mouse_ef_map_y,n=o.mouse_ef_map_x;o.mouse_ef_map_y=e.clientX,o.mouse_ef_map_x=e.clientY,o.delta_ef_map_x+=n-o.mouse_ef_map_x,o.delta_ef_map_y+=t-o.mouse_ef_map_y}}),t.addEventListener("mousedown",e=>{o.dragging=!0,o.mouse_ef_map_y=e.clientX,o.mouse_ef_map_x=e.clientY}),t.addEventListener("mouseup",e=>{o.dragging=!1}),t.addEventListener("wheel",e=>{e.preventDefault(),o.three_d_zoom_level+=e.deltaY/2})):(t.addEventListener("click",n=>{Y(n,t),G(e,r.current_x_position,r.current_y_position)}),t.addEventListener("mousemove",n=>{const r=t.getBoundingClientRect();let a=Math.floor((n.clientX-r.left)/o.cellSize),l=Math.floor((n.clientY-r.top)/o.cellSize);if(a>=0&&l>=0){let t=e.getef(a,l);a=(""+a).padStart(3," "),l=(""+(e.height()-l-1)).padStart(3," "),t=(""+t.toFixed(2)).padStart(5," "),document.getElementById("status").innerHTML=`x: ${a} y: ${l}\nvolts: ${t}`}}))}function Y(e,t){const n=t.getBoundingClientRect();r.current_x_position=(e.clientX-n.left)/o.cellSize,r.current_y_position=(e.clientY-n.top)/o.cellSize,document.getElementById("x-position").value=r.current_x_position,document.getElementById("y-position").value=o.map_height-r.current_y_position}function G(e,t,n){if(o.electric_fields_calculated){e.update_voltages(r.electrode_volts),e.update_offsets(r.electrode_offsets),o.no_lines=!1;let a=t+.001,l=n+.001,i=r.current_x_velocity+.001,c=-(r.current_y_velocity+.001),d=r.current_mz,s=Math.random();if(0!=r.random_ke){let e=2*s*Math.PI,t=160218e-24*r.random_ke,n=Math.sqrt(2*t/(1660538921e-36*d))/1e3;i+=n*Math.cos(e),c+=n*Math.sin(e)}o.latest_ion=[a,l,i,c,d,s];const f=performance.now();let u=e.fly_ion(o.latest_ion);const m=performance.now();console.log(`Flew ion in ${m-f} milliseconds`),o.latest_ion_path=u.slice(0,-1);let _=o.latest_ion_path.length;if(o.three_dimension_view){J(o.fake_canvas,1);const e=o.gl;let t=o.fake_canvas.getImageData(0,0,o.map_width,o.map_height);e.bindTexture(e.TEXTURE_2D,e.createTexture()),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D)}else{J(document.getElementById("electric_field_map").getContext("2d"),o.cellSize)}J(document.getElementById("electrode_map").getContext("2d"),o.cellSize);let p=o.latest_ion_path[_-2].toFixed(0),g=e.height()-o.latest_ion_path[_-1].toFixed(0)-1,y=1e3*u[u.length-4],h=r.max_time<=1e3*y?"Time!!":"Splat!",b=`(${a.toFixed(0)},${l.toFixed(0)})->(${p},${g})`,v=u[u.length-1],E=`${h} ${y.toFixed(2)} µs ${d}mz ${b} ${v} collisions`;o.splatlog.push(E),document.getElementById("splatlog").innerHTML=o.splatlog.join("\n")}else e.update_voltages(r.electrode_volts),e.generate_electric_fields(),o.electric_fields_calculated=!0,X(e)}function J(e,t){e.beginPath(),e.strokeStyle="#000",e.moveTo(o.latest_ion_path[1]*t,o.latest_ion_path[2]*t);var n=800,r=800;for(let a=0;a<o.latest_ion_path.length;a+=3){let l=o.latest_ion_path[a+1]*t,i=o.latest_ion_path[a+2]*t;Math.abs(l-n)+Math.abs(i-r)>.25&&(e.lineTo(l,i),n=l,r=i)}e.stroke()}function K(e){const t=document.getElementById("voltage_input");t.oninput=()=>{if(0!=o.active_electrode){const n=t.value;n<=2e4&&n>=-2e4&&(r.electrode_volts[o.active_electrode]=n,e.update_voltages(r.electrode_volts),o.voltages_were_updated=!0),o.efmap_altered=1}},document.getElementById("electrode1").style.boxShadow="0px 0px 3px 1px black";for(let e=0;e<l.length;e++)document.getElementById("electrode"+e).style.background=c[e],document.getElementById("electrode"+e).addEventListener("click",()=>{o.active_electrode=e,Z();for(let e=0;e<l.length;e++)document.getElementById("electrode"+e).style.boxShadow=e==o.active_electrode?"0px 0px 3px 1px black":"";t.value=0==e?0:r.electrode_volts[o.active_electrode]});document.getElementById("brush1").style.boxShadow="0px 0px 3px 1px black";for(let e=1;e<6;e++)document.getElementById("brush"+e).addEventListener("click",t=>{o.brush=e;for(let e=1;e<6;e++)document.getElementById("brush"+e).style.boxShadow=e==o.brush?"0px 0px 3px 1px black":""});document.getElementById("brush6").addEventListener("click",t=>{!function(e){0==o.history1&&0==o.history2||(o.history3=o.history2,o.history2=o.history1,o.history1=0,Q(e,o.history3,o.map_width/2,o.map_height/2),o.emap_altered=!0)}(e)}),document.getElementById("splattable").addEventListener("change",t=>{r.splattable[o.active_electrode]=t.target.checked&&0!=o.active_electrode?1:0,d(e)}),document.getElementById("dc_mode").addEventListener("change",e=>{e.target.checked&&0!=o.active_electrode?(r.dc_only[o.active_electrode]=0,document.getElementById("sin_frequency").disabled=!1,document.getElementById("offset").disabled=!1,document.getElementById("pulse_start").disabled=!0,document.getElementById("pulse_end").disabled=!0):(r.dc_only[o.active_electrode]=1,document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("pulse_start").disabled=!1,document.getElementById("pulse_end").disabled=!1)}),document.getElementById("magnet_mode").addEventListener("change",t=>{t.target.checked&&0!=o.active_electrode?(r.magnet_mode[o.active_electrode]=1,document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("dc_mode").disabled=!0,document.getElementById("splattable").disabled=!0,document.getElementById("pulse_start").disabled=!0,document.getElementById("pulse_end").disabled=!0):(r.magnet_mode[o.active_electrode]=0,document.getElementById("sin_frequency").disabled=!1,document.getElementById("offset").disabled=!1,document.getElementById("dc_mode").disabled=!1,document.getElementById("splattable").disabled=!1,document.getElementById("pulse_start").disabled=!1,document.getElementById("pulse_end").disabled=!1),Z(),d(e)}),document.getElementById("update").addEventListener("click",t=>{te(e),e.update_timeline(r.dc_only,r.electrode_frequencies,r.pulse_starts,r.pulse_ends),console.log("Made timeline");const n=performance.now();e.generate_electric_fields();const a=performance.now();console.log(`Updated voltages ${r.electrode_volts} and solids ${r.splattable} in ${a-n} milliseconds`),o.electric_fields_calculated=!0,o.fake_canvas=null,X(e)}),document.getElementById("fly'm").addEventListener("click",t=>{r.current_x_position=parseFloat(document.getElementById("x-position").value),r.current_y_position=o.map_height-parseFloat(document.getElementById("y-position").value),G(e,r.current_x_position,r.current_y_position)}),document.getElementById("clear").addEventListener("click",t=>{o.no_lines=!0,e.clear(),Z(),m(e),d(e)});for(let t=0;t<document.getElementsByClassName("loadbutton").length;t++){let n=document.getElementsByClassName("loadbutton")[t].id;document.getElementById(n).addEventListener("click",t=>{ee(e,n)})}}function Z(){document.getElementById("splattable").disabled=!Boolean(o.active_electrode),document.getElementById("splattable").checked=r.splattable[o.active_electrode],document.getElementById("dc_mode").disabled=!Boolean(o.active_electrode),document.getElementById("dc_mode").checked=!r.dc_only[o.active_electrode],document.getElementById("magnet_mode").checked=r.magnet_mode[o.active_electrode],document.getElementById("sin_frequency").value=r.electrode_frequencies[o.active_electrode],document.getElementById("offset").value=r.electrode_offsets[o.active_electrode],document.getElementById("ion_x_velocity").value=r.current_x_velocity,document.getElementById("ion_y_velocity").value=r.current_y_velocity,document.getElementById("pressure").value=r.pressure,document.getElementById("magnet_mode").checked?(document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("dc_mode").disabled=!0,document.getElementById("splattable").disabled=!0):document.getElementById("dc_mode").checked?(document.getElementById("sin_frequency").disabled=!1,document.getElementById("offset").disabled=!1,document.getElementById("pulse_start").disabled=!0,document.getElementById("pulse_end").disabled=!0):(document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("pulse_start").disabled=!1,document.getElementById("pulse_end").disabled=!1),document.getElementById("voltage_input").value=0==o.active_electrode?0:r.electrode_volts[o.active_electrode]}function Q(e,t,n,o){for(let r=0;r<n;r++)for(let a=0;a<o;a++)e.brush(r,a,t[r+n*a])}async function ee(e,t){let a;if("string"==typeof t||t instanceof String){if("clear"===t)return;a=t.endsWith("map")?await n(15)(`./${t}.json`).catch(console.error):await n(14)(`./${t}_map.json`).catch(console.error)}else a=t;let l=a.state;Q(e,a.map,o.map_width/2,o.map_height/2),Object.keys(r).forEach(e=>{r[e]=l[e]}),o.emap_altered=!0,te(e),""==document.getElementById("playgrounddiv").style.backgroundColor&&document.getElementById("playground").click(),m(e)}function te(e){e.update_pressure(r.pressure),e.update_offsets(r.electrode_offsets),e.update_solids(r.splattable),e.update_magnets(r.magnet_mode),e.update_gas_mass(r.background_gas_mass),e.update_voltages(r.electrode_volts),Z()}function ne(e){o.dragging||1==o.brush||(o.to_apply=[]);for(let e=1;e<5;e++)document.getElementById("electrode"+e).innerHTML=`${r.electrode_volts[e]} ${r.magnet_mode[e]?"T":"V"}`;document.getElementById("set_voltage").innerHTML=r.magnet_mode[o.active_electrode]?"Set Teslas":"Set Volts",o.mouse_on_electrode_map&&function(e){if(!o.dragging){const t=o.scale,n=o.cellSize*t;let r=document.getElementById("electrode_map");const a=r.getBoundingClientRect();let i=o.mouse_electrode_map_x-a.left,c=o.mouse_electrode_map_y-a.top;if(i=Math.round(i/(2*o.cellSize)-.65),c=Math.round(c/(2*o.cellSize)-.65),o.previous_mouse_electrode_position_x2!=i||o.previous_mouse_electrode_position_y2!=c){d(e),o.previous_mouse_electrode_position_x2=i,o.previous_mouse_electrode_position_y2=c;const t=r.getContext("2d");if(t.fillStyle=l[o.active_electrode],1==o.brush||5==o.brush)t.fillRect(i*n,c*n,1*n,1*n);else if(2==o.brush)if(-1==o.initial_click[0]&&-1==o.initial_click[1])t.fillRect(i*n,c*n,n,n);else{let e=s(Math.floor(o.initial_click[0]/(2*o.cellSize)),Math.floor(o.initial_click[1]/(2*o.cellSize)),i,c);for(let o of e)t.fillRect(o[0]*n,o[1]*n,n,n)}else if(3==o.brush)if(-1==o.initial_click[0]&&-1==o.initial_click[1])t.fillRect(i*n,c*n,n,n);else{let e=u(Math.floor(o.initial_click[0]/(2*o.cellSize)),Math.floor(o.initial_click[1]/(2*o.cellSize)),i,c);for(let o of e)t.fillRect(o[0]*n,o[1]*n,n,n)}else if(4==o.brush)if(-1==o.initial_click[0]&&-1==o.initial_click[1])t.fillRect(i*n,c*n,n,n);else{let e=f(Math.floor(o.initial_click[0]/(2*o.cellSize)),Math.floor(o.initial_click[1]/(2*o.cellSize)),i,c);for(let o of e)t.fillRect(o[0]*n,o[1]*n,n,n)}}}}(e),o.emap_altered&&(d(e),o.emap_altered=!1),o.voltages_were_updated&&(X(e),o.voltages_were_updated=!1)}!async function(){document.getElementById("dummyplayground").style.display="inline-block";const e=new((await n.e(15).then(n.bind(null,20)).catch(console.error)).Environment)(o.map_width,o.map_height,o.scale,r.max_time,r.electrode_volts,r.splattable,r.pressure,r.background_gas_mass);let t=document.getElementById("electrode_map"),a=document.getElementById("electric_field_map");window.screen.height*window.devicePixelRatio<1070&&(o.cellSize=2,o.canvas_height=400,o.canvas_width=400,a.width="400",a.height="400",t.width="400",t.height="400",document.getElementById("status").style.bottom="-445px",document.getElementById("status").style.left="-380px",document.getElementById("splatlog").style.width="280px"),function(){let e=location.pathname.split("/"),t=e[e.length-1];if(""!==t){let e=document.querySelectorAll(".topnav a");for(let n=0,o=e.length;n<o;n++)0==e[n].getAttribute("href").indexOf(t)&&(e[n].className+="current_page")}}(),function(){let e=document.getElementById("playground"),t=document.getElementById("playgrounddiv"),n=document.getElementsByClassName("collapsible");for(let e=0;e<n.length;e++)n[e].addEventListener("click",(function(){this.classList.toggle("active");let e=this.nextElementSibling;"block"==e.style.display?e.style.display="none":e.style.display="block"})),n[e].nextElementSibling.style.display="none";e.click(),e.click(),e.addEventListener("click",e=>{"rgb(243, 243, 243)"==t.style.backgroundColor?(o.three_dimension_view&&document.getElementById("3d_view").click(),t.style.backgroundColor="",t.style.boxShadow=""):(t.style.backgroundColor="rgb(243, 243, 243)",t.style.boxShadow="0 2px 3px 0 #00000033, 0 2px 4px 0 #00000030")}),document.getElementById("advanced").click(),document.getElementById("advanced").click(),document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0;var r=document.getElementById("topnav"),a=t.offsetTop+r.offsetHeight;window.onscroll=()=>{window.pageYOffset>a?t.classList.add("sticky"):t.classList.remove("sticky")},document.getElementById("dummyplayground").style.display="none",document.getElementById("playgrounddiv").style.display="inline-block"}(),K(e),function(e){document.getElementById("SIMION_SAVE").addEventListener("click",t=>{e.generate_electrodes();let n=e.save_simion_pa();var o=new Blob([n],{type:"octet/stream"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(o,"electrodes.pa");else{let e=document.createElement("a"),t=URL.createObjectURL(o);e.href=t,e.download="electrodes.pa",document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e),window.URL.revokeObjectURL(t)}),0)}}),document.getElementById("JSON_SAVE").addEventListener("click",t=>{const n=Array.from(e.electrode_pixels(),e=>e),o=new Blob([JSON.stringify({map:n,state:r})],{type:"text/plain"});let a=document.createElement("a");const l=URL.createObjectURL(o);a.href=l,a.download="electrodes.json",document.body.appendChild(a),a.click(),setTimeout((function(){document.body.removeChild(a),window.URL.revokeObjectURL(l)}),0)}),document.getElementById("JSON_LOAD").addEventListener("change",t=>{const n=t.target.files[0];if(n){const t=new FileReader;t.addEventListener("load",n=>{ee(e,JSON.parse(t.result))}),t.readAsText(n)}});const t=document.getElementById("3d_view");t.addEventListener("click",n=>{o.refresh_canvas=1;let r=document.getElementById("electric_field_map"),a=r.cloneNode(!1);r.parentNode.replaceChild(a,r),o.three_dimension_view?(t.innerHTML="3D</br>view",o.gl=null,o.three_dimension_view=0):(t.innerHTML="2D</br>view",o.gl=r.getContext("webgl2"),o.three_dimension_view=1),H(e),X(e)}),document.getElementById("mz_ratio").addEventListener("input",e=>{r.current_mz=parseFloat(document.getElementById("mz_ratio").value)}),document.getElementById("ion_x_velocity").addEventListener("input",e=>{r.current_x_velocity=parseFloat(document.getElementById("ion_x_velocity").value)}),document.getElementById("ion_y_velocity").addEventListener("input",e=>{r.current_y_velocity=parseFloat(document.getElementById("ion_y_velocity").value)}),document.getElementById("randomizer").addEventListener("input",e=>{r.random_ke=parseFloat(document.getElementById("randomizer").value)}),document.getElementById("pulse_start").addEventListener("input",e=>{r.pulse_starts[o.active_electrode]=parseFloat(document.getElementById("pulse_start").value)}),document.getElementById("pulse_end").addEventListener("input",e=>{r.pulse_ends[o.active_electrode]=parseFloat(document.getElementById("pulse_end").value)}),document.getElementById("pressure").addEventListener("input",t=>{r.pressure=parseFloat(document.getElementById("pressure").value),e.update_pressure(r.pressure)}),document.getElementById("fdm_threshold").addEventListener("change",t=>{r.fdm_accuracy=parseFloat(document.getElementById("fdm_threshold").value),e.update_fdm_threshold(r.fdm_accuracy)}),document.getElementById("bg_gas").addEventListener("change",t=>{r.background_gas_mass=parseFloat(document.getElementById("bg_gas").value),e.update_gas_mass(r.background_gas_mass)}),document.getElementById("sin_frequency").addEventListener("input",e=>{r.electrode_frequencies[o.active_electrode]=parseFloat(document.getElementById("sin_frequency").value)}),document.getElementById("offset").addEventListener("input",t=>{r.electrode_offsets[o.active_electrode]=parseFloat(document.getElementById("offset").value),e.update_offsets(r.electrode_offsets)})}(e),H(e),p(e),d(e),X(e),setInterval(ne.bind(null,e,t),60)}()}});