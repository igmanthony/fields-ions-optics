!function(e){function t(t){for(var l,o,d=t[0],c=t[1],i=0,a=[];i<d.length;i++)o=d[i],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&a.push(n[o][0]),n[o]=0;for(l in c)Object.prototype.hasOwnProperty.call(c,l)&&(e[l]=c[l]);for(r&&r(t);a.length;)a.shift()()}var l={},n={0:0};var o={};var d={2:function(){return{"./index_bg.js":{__wbindgen_throw:function(e,t){return l[1].exports.b(e,t)}}}}};function c(t){if(l[t])return l[t].exports;var n=l[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(e){var t=[],l=n[e];if(0!==l)if(l)t.push(l[2]);else{var i=new Promise((function(t,o){l=n[e]=[t,o]}));t.push(l[2]=i);var a,s=document.createElement("script");s.charset="utf-8",s.timeout=120,c.nc&&s.setAttribute("nonce",c.nc),s.src=function(e){return c.p+""+({}[e]||e)+".js"}(e);var r=new Error;a=function(t){s.onerror=s.onload=null,clearTimeout(u);var l=n[e];if(0!==l){if(l){var o=t&&("load"===t.type?"missing":t.type),d=t&&t.target&&t.target.src;r.message="Loading chunk "+e+" failed.\n("+o+": "+d+")",r.name="ChunkLoadError",r.type=o,r.request=d,l[1](r)}n[e]=void 0}};var u=setTimeout((function(){a({type:"timeout",target:s})}),12e4);s.onerror=s.onload=a,document.head.appendChild(s)}return({1:[2]}[e]||[]).forEach((function(e){var l=o[e];if(l)t.push(l);else{var n,i=d[e](),a=fetch(c.p+""+{2:"8ffc3334e33e5b8a5f2a"}[e]+".module.wasm");if(i instanceof Promise&&"function"==typeof WebAssembly.compileStreaming)n=Promise.all([WebAssembly.compileStreaming(a),i]).then((function(e){return WebAssembly.instantiate(e[0],e[1])}));else if("function"==typeof WebAssembly.instantiateStreaming)n=WebAssembly.instantiateStreaming(a,i);else{n=a.then((function(e){return e.arrayBuffer()})).then((function(e){return WebAssembly.instantiate(e,i)}))}t.push(o[e]=n.then((function(t){return c.w[e]=(t.instance||t).exports})))}})),Promise.all(t)},c.m=e,c.c=l,c.d=function(e,t,l){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:l})},c.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var l=Object.create(null);if(c.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)c.d(l,n,function(t){return e[t]}.bind(null,n));return l},c.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="",c.oe=function(e){throw console.error(e),e},c.w={};var i=window.webpackJsonp=window.webpackJsonp||[],a=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var r=a;c(c.s=0)}([function(e,t,l){"use strict";l.r(t),l.d(t,"electrode_map",(function(){return q})),l.d(t,"electric_field_map",(function(){return O}));const n=["#ffffff","#f44336","#4CAF50","#2196F3","#795548"],o=["#ffffff","#FFCDD2","#C8E6C9","#BBDEFB","#D7CCC8"],d=["#ffffff","#E57373","#81C784","#64B5F6","#A1887F"],c=[-1,0,0,0,0],i=[!0,!0,!0,!0,!0],a=[0,100,100,100,100],s=[0,0,0,0,0],r=[0,70,100,1,-1],u=[0,1e3,-500,0,1020],f=[-1,0,0,1,0],_=[0,40,1,-40,1],m=[0,110,110,110,110],p=[0,10,0,10,0],g=[0,153.55994,0,153.55994,0],y=[0,0,1,0,0],b=[0,150,350,-150,-400],h=[0,70,70,70,70],v=[!0,!1,!0,!1,!0];var E={electrode_volts:[0,500,1e3,-500,-1e3],splattable:[-1,0,0,0,0],electrode_frequencies:[0,1600,1600,1600,1600],electrode_offsets:[0,0,0,0,0],pulse_starts:[0,0,0,0,0],pulse_ends:[0,4e5,4e5,4e5,4e5],active_electrode:1,emap_altered:!1,dragging:!1,dragging_frame:0,initial_click:[-1,-1],brush:1,cmap:["#30123b","#311542","#32184a","#341b51","#351e58","#36215f","#372365","#38266c","#392972","#3a2c79","#3b2f7f","#3c3285","#3c358b","#3d3791","#3e3a96","#3f3d9c","#4040a1","#4043a6","#4145ab","#4148b0","#424bb5","#434eba","#4350be","#4353c2","#4456c7","#4458cb","#455bce","#455ed2","#4560d6","#4563d9","#4666dd","#4668e0","#466be3","#466de6","#4670e8","#4673eb","#4675ed","#4678f0","#467af2","#467df4","#467ff6","#4682f8","#4584f9","#4587fb","#4589fc","#448cfd","#438efd","#4291fe","#4193fe","#4096fe","#3f98fe","#3e9bfe","#3c9dfd","#3ba0fc","#39a2fc","#38a5fb","#36a8f9","#34aaf8","#33acf6","#31aff5","#2fb1f3","#2db4f1","#2bb6ef","#2ab9ed","#28bbeb","#26bde9","#25c0e6","#23c2e4","#21c4e1","#20c6df","#1ec9dc","#1dcbda","#1ccdd7","#1bcfd4","#1ad1d2","#19d3cf","#18d5cc","#18d7ca","#17d9c7","#17dac4","#17dcc2","#17debf","#18e0bd","#18e1ba","#19e3b8","#1ae4b6","#1be5b4","#1de7b1","#1ee8af","#20e9ac","#22eba9","#24eca6","#27eda3","#29eea0","#2cef9d","#2ff09a","#32f197","#35f394","#38f491","#3bf48d","#3ff58a","#42f687","#46f783","#4af880","#4df97c","#51f979","#55fa76","#59fb72","#5dfb6f","#61fc6c","#65fc68","#69fd65","#6dfd62","#71fd5f","#74fe5c","#78fe59","#7cfe56","#80fe53","#84fe50","#87fe4d","#8bfe4b","#8efe48","#92fe46","#95fe44","#98fe42","#9bfd40","#9efd3e","#a1fc3d","#a4fc3b","#a6fb3a","#a9fb39","#acfa37","#aef937","#b1f836","#b3f835","#b6f735","#b9f534","#bbf434","#bef334","#c0f233","#c3f133","#c5ef33","#c8ee33","#caed33","#cdeb34","#cfea34","#d1e834","#d4e735","#d6e535","#d8e335","#dae236","#dde036","#dfde36","#e1dc37","#e3da37","#e5d838","#e7d738","#e8d538","#ead339","#ecd139","#edcf39","#efcd39","#f0cb3a","#f2c83a","#f3c63a","#f4c43a","#f6c23a","#f7c039","#f8be39","#f9bc39","#f9ba38","#fab737","#fbb537","#fbb336","#fcb035","#fcae34","#fdab33","#fda932","#fda631","#fda330","#fea12f","#fe9e2e","#fe9b2d","#fe982c","#fd952b","#fd9229","#fd8f28","#fd8c27","#fc8926","#fc8624","#fb8323","#fb8022","#fa7d20","#fa7a1f","#f9771e","#f8741c","#f7711b","#f76e1a","#f66b18","#f56817","#f46516","#f36315","#f26014","#f15d13","#ef5a11","#ee5810","#ed550f","#ec520e","#ea500d","#e94d0d","#e84b0c","#e6490b","#e5460a","#e3440a","#e24209","#e04008","#de3e08","#dd3c07","#db3a07","#d93806","#d73606","#d63405","#d43205","#d23005","#d02f04","#ce2d04","#cb2b03","#c92903","#c72803","#c52602","#c32402","#c02302","#be2102","#bb1f01","#b91e01","#b61c01","#b41b01","#b11901","#ae1801","#ac1601","#a91501","#a61401","#a31201","#a01101","#9d1001","#9a0e01","#970d01","#940c01","#910b01","#8e0a01","#8b0901","#870801","#840701","#810602","#7d0502","#7a0402"],electric_fields_calculated:!1,voltages_were_updated:!1,latest_ion_path:[],latest_ion:[],current_mz:100,current_x_position:0,current_y_position:0,current_x_velocity:0,current_y_velocity:0,mouse_on_electrode_map:!1,previous_mouse_electrode_position_x:-1,previous_mouse_electrode_position_y:-1,previous_mouse_electrode_position_x2:-1,previous_mouse_electrode_position_y2:-1,mouse_electrode_map_x:0,mouse_electrode_map_y:0,no_lines:!0,splatlog:[],dc_only:[1,1,1,1,1],magnet_mode:[0,0,0,0,0],to_apply:[],rect:[0,0],pressure:0,background_gas_mass:4,cellSize:3,scale:2,map_width:200,map_height:200,max_time:4e5,canvas_width:600,canvas_height:600,history1:0,history2:0,history3:Array(1e4).fill(0)};function B(e){const t=e.scale(),l=e.width()/t,d=e.height()/t,c=E.cellSize*t,i=e.electrode_pixels(),a=q.getContext("2d");for(let e=0;e<l;e++)for(let t=0;t<d;t++){const d=i[t*l+e];if(1==E.magnet_mode[d]&&d>0){if(a.fillStyle=o[d],a.fillRect(e*c,t*c,c,c),e%3==0&&t%3==0)if(a.fillStyle=n[d],E.electrode_volts[d]>0)for(let l=0;l<c;l++)a.fillRect(e*c+l,t*c+l,1,1),a.fillRect(e*c-l+(c-1),t*c+l,1,1);else a.fillRect(e*c+2,t*c+2,2,2)}else 1==E.splattable[d]&&d>0?(a.fillStyle=n[0],a.fillRect(e*c,t*c,c,c),a.fillStyle=o[d],a.fillRect(e*c+2,t*c+2,2,2)):(a.fillStyle=n[d],a.fillRect(e*c,t*c,c,c))}}function I(e,t,l,n){let o=[],d=l-e,c=n-t,i=Math.max(Math.abs(d),Math.abs(c));for(let d=0;d<=i;d++){let c=0===i?0:d/i,a=e+c*(l-e),s=t+c*(n-t);o.push([Math.round(a),Math.round(s)])}return o}function x(e,t,l,n){let o=I(e,t,l,t),d=I(e,n,l,n);return[...o,...I(e,t,e,n),...I(l,t,l,n),...d]}function k(e,t,l,n){let o=Math.abs(e-l)+e,d=Math.abs(t-n)+t,c=(Math.abs(e-l),Math.abs(t-n),Math.abs(o-e)),i=Math.abs(d-t),a=[];for(let l=t-d;l<t+d;l++){for(let n=e-o;n<e+o;n++)(n-e)*(n-e)/(c*c)+(l-t)*(l-t)/(i*i)<=1&&(n-e)*(n-e)/((c-1)*(c-1))+(l-t)*(l-t)/((i-1)*(i-1))>1&&a.push([Math.round(n),Math.round(l)])}return a}function S(e){E.history1=E.history2,E.history2=E.history3,E.history3=e.electrode_pixels()}function w(e,t){if(E.dragging)E.to_apply.push([E.mouse_electrode_map_x,E.mouse_electrode_map_y]);else if("click"==e.type){E.no_lines=!0;const e=q.getBoundingClientRect();let l=E.mouse_electrode_map_x-e.left,n=E.mouse_electrode_map_y-e.top;if(E.emap_altered=!0,l=Math.floor(l/(2*E.cellSize)),n=Math.floor(n/(2*E.cellSize)),l<0||n<0)return;if(1==E.brush)E.previous_mouse_electrode_position_x==l&&E.previous_mouse_electrode_position_y==n||(t.brush(l,n,E.active_electrode),E.previous_mouse_electrode_position_x=l,E.previous_mouse_electrode_position_y=n);else if(2!=E.brush||E.dragging)if(3!=E.brush||E.dragging)if(4!=E.brush||E.dragging){if(5==E.brush&&!E.dragging){const e=t.scale(),o=t.width()/e,d=t.height()/e;let c=function(e,t,l,n,o){let d=[],c=l[t*n+e],i=[];for(i.push([e,t]);0!=i.length;){let e=i.pop(),t=e[1],a=e[0];if(l[t*n+a]==c){d.push(t*n+a);for(let e of[[a+1,t],[a-1,t],[a,t+1],[a,t-1]])0<=e[0]&&e[0]<=n-1&&0<=e[1]&&e[1]<=o-1&&(d.includes(e[1]*n+e[0])||i.push(e))}}return d}(l,n,t.electrode_pixels(),o,d);for(let e of c)t.brush(e%o,Math.floor(e/o),E.active_electrode)}}else{let e=x(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),l,n);for(let l of e)t.brush(l[0],l[1],E.active_electrode)}else{let e=k(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),l,n);for(let l of e)t.brush(l[0],l[1],E.active_electrode)}else{let e=I(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),l,n);for(let l of e)t.brush(l[0],l[1],E.active_electrode)}S(t)}}function M(e){const t=O.getContext("2d"),l=e.efpix(),n=Math.max(...l),o=Math.min(...l);for(let e=0;e<E.map_width;e++)for(let d=0;d<E.map_height;d++){let c=l[d*E.map_width+e],i=Math.floor((c-o)/(n-o)*255);t.fillStyle=E.cmap[i],t.fillRect(e*E.cellSize,d*E.cellSize,E.cellSize,E.cellSize)}}function z(e,t,l){if(E.electric_fields_calculated){e.update_voltages(E.electrode_volts),e.update_offsets(E.electrode_offsets),E.no_lines=!1;let n=t+.001,o=l+.001,d=E.current_x_velocity+.001,c=-(E.current_y_velocity+.001),i=E.current_mz;E.latest_ion=[n,o,d,c,i,Math.random()];let a=e.fly_ion(E.latest_ion);E.latest_ion_path=a.slice(0,-1);let s=E.latest_ion_path.length;L(O),L(q);let r=E.latest_ion_path[s-2].toFixed(0),u=e.height()-E.latest_ion_path[s-1].toFixed(0)-1,f=`${s/3>=E.max_time?"Time!!":"Splat!"} ${s/3}ns ${i}mz ${`(${n.toFixed(0)},${o.toFixed(0)})->(${r},${u})`} ${a[a.length-1]} collisions`;E.splatlog.push(f),document.getElementById("splatlog").innerHTML=E.splatlog.join("\n")}else e.update_voltages(E.electrode_volts),e.generate_electric_fields(),E.electric_fields_calculated=!0,M(e)}function L(e){const t=e.getContext("2d");t.beginPath(),t.strokeStyle="#000",t.moveTo(E.latest_ion_path[1]*E.cellSize,E.latest_ion_path[2]*E.cellSize);var l=800,n=800;for(let e=0;e<E.latest_ion_path.length;e+=3){let o=E.latest_ion_path[e+1]*E.cellSize,d=E.latest_ion_path[e+2]*E.cellSize;Math.abs(o-l)+Math.abs(d-n)>.25&&(t.lineTo(o,d),l=o,n=d)}t.stroke()}function C(){document.getElementById("splattable").disabled=!Boolean(E.active_electrode),document.getElementById("splattable").checked=E.splattable[E.active_electrode],document.getElementById("dc_mode").disabled=!Boolean(E.active_electrode),document.getElementById("dc_mode").checked=!E.dc_only[E.active_electrode],document.getElementById("magnet_mode").checked=E.magnet_mode[E.active_electrode],document.getElementById("sin_frequency").value=E.electrode_frequencies[E.active_electrode],document.getElementById("offset").value=E.electrode_offsets[E.active_electrode],document.getElementById("magnet_mode").checked?(document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("dc_mode").disabled=!0,document.getElementById("splattable").disabled=!0):document.getElementById("dc_mode").checked?(document.getElementById("sin_frequency").disabled=!1,document.getElementById("offset").disabled=!1,document.getElementById("pulse_start").disabled=!0,document.getElementById("pulse_end").disabled=!0):(document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("pulse_start").disabled=!1,document.getElementById("pulse_end").disabled=!1),document.getElementById("voltage_input").value=0==E.active_electrode?0:E.electrode_volts[E.active_electrode]}function R(e,t,l,o,I,x){const k=document.getElementById("voltage_input");k.oninput=()=>{if(0!=E.active_electrode){const t=k.value;t<=2e4&&t>=-2e4&&(E.electrode_volts[E.active_electrode]=t,e.update_voltages(E.electrode_volts),E.voltages_were_updated=!0)}},document.getElementById("electrode1").style.boxShadow="0px 0px 3px 1px black";for(let e=0;e<n.length;e++)document.getElementById("electrode"+e).style.background=d[e],document.getElementById("electrode"+e).addEventListener("click",()=>{E.active_electrode=e,C();for(let e=0;e<n.length;e++)document.getElementById("electrode"+e).style.boxShadow=e==E.active_electrode?"0px 0px 3px 1px black":"";k.value=0==e?0:E.electrode_volts[E.active_electrode]});document.getElementById("brush1").style.boxShadow="0px 0px 3px 1px black";for(let e=1;e<6;e++)document.getElementById("brush"+e).addEventListener("click",t=>{E.brush=e;for(let e=1;e<6;e++)document.getElementById("brush"+e).style.boxShadow=e==E.brush?"0px 0px 3px 1px black":""});document.getElementById("brush6").addEventListener("click",t=>{!function(e){if(0==E.history1&&0==E.history2)return;E.history3=E.history2,E.history2=E.history1,E.history1=0;let t=E.map_width/2,l=E.map_height/2;for(let n=0;n<t;n++)for(let o=0;o<l;o++){let l=E.history3[n+t*o];e.brush(n,o,l)}E.emap_altered=!0}(e)}),document.getElementById("splattable").addEventListener("change",t=>{E.splattable[E.active_electrode]=t.target.checked&&0!=E.active_electrode?1:0,B(e)}),document.getElementById("dc_mode").addEventListener("change",e=>{e.target.checked&&0!=E.active_electrode?(E.dc_only[E.active_electrode]=0,document.getElementById("sin_frequency").disabled=!1,document.getElementById("offset").disabled=!1,document.getElementById("pulse_start").disabled=!0,document.getElementById("pulse_end").disabled=!0):(E.dc_only[E.active_electrode]=1,document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("pulse_start").disabled=!1,document.getElementById("pulse_end").disabled=!1)}),document.getElementById("magnet_mode").addEventListener("change",t=>{t.target.checked&&0!=E.active_electrode?(E.magnet_mode[E.active_electrode]=1,document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0,document.getElementById("dc_mode").disabled=!0,document.getElementById("splattable").disabled=!0,document.getElementById("pulse_start").disabled=!0,document.getElementById("pulse_end").disabled=!0):(E.magnet_mode[E.active_electrode]=0,document.getElementById("sin_frequency").disabled=!1,document.getElementById("offset").disabled=!1,document.getElementById("dc_mode").disabled=!1,document.getElementById("splattable").disabled=!1,document.getElementById("pulse_start").disabled=!1,document.getElementById("pulse_end").disabled=!1),C(),B(e)}),document.getElementById("update").addEventListener("click",t=>{e.update_voltages(E.electrode_volts),e.update_solids(E.splattable),e.update_magnets(E.magnet_mode),C(),console.log(`Updated voltages ${E.electrode_volts} and solids ${E.splattable}`),e.update_timeline(E.dc_only,E.electrode_frequencies,E.pulse_starts,E.pulse_ends),console.log("Made timeline"),e.generate_electric_fields(),console.log("Updated electrodes & generated electric fields"),E.electric_fields_calculated=!0,M(e)}),document.getElementById("fly'm").addEventListener("click",t=>{E.current_x_position=parseFloat(document.getElementById("x-position").value),E.current_y_position=E.map_height-parseFloat(document.getElementById("y-position").value),console.log(E.current_x_position),console.log(E.current_y_position),z(e,E.current_x_position,E.current_y_position)}),document.getElementById("clear").addEventListener("click",t=>{E.no_lines=!0,e.clear(),C(),S(e),B(e)}),document.getElementById("einzel_lens").addEventListener("click",l=>F(e,t,r,c,a,i,0,s,s)),document.getElementById("tof").addEventListener("click",t=>F(e,l,u,f,a,i,0,s,s)),document.getElementById("quadrupole").addEventListener("click",t=>F(e,o,_,c,m,v,0,p,s)),document.getElementById("cyclotron").addEventListener("click",t=>F(e,I,_,c,g,v,0,s,y)),document.getElementById("ion_funnel").addEventListener("click",t=>F(e,x,b,c,h,v,30,s,s)),document.getElementById("SIMION_SAVE").addEventListener("click",t=>{e.generate_electrodes();let l=e.save_simion_pa();var n=new Blob([l],{type:"octet/stream"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,"electrodes.pa");else{let e=document.createElement("a"),t=URL.createObjectURL(n);e.href=t,e.download="electrodes.pa",document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e),window.URL.revokeObjectURL(t)}),0)}}),document.getElementById("field_lines").addEventListener("click",t=>{!function(e){const t=O.getContext("2d"),l=e.efpix(),n=e.width()*E.cellSize,o=e.height()*E.cellSize;for(let e=1;e<n-5;e+=5)for(let d=1;d<o-5;d+=5){let o=d*(n/3)+e;t.beginPath();let c=l[o+1],i=l[o-1],a=l[o+n],s=i-c,r=l[o-n]-a,u=Math.sqrt(s*s+r*r)/8,f=s/u,_=r/u;t.strokeStyle="#000";let m=e*E.cellSize,p=d*E.cellSize,g=m+f,y=p+_;t.moveTo(m,p),t.lineTo(g,y),t.stroke(),t.fill}}(e)}),document.getElementById("mz_ratio").addEventListener("input",e=>{E.current_mz=parseFloat(document.getElementById("mz_ratio").value)}),document.getElementById("ion_x_velocity").addEventListener("input",e=>{E.current_x_velocity=parseFloat(document.getElementById("ion_x_velocity").value)}),document.getElementById("ion_y_velocity").addEventListener("input",e=>{E.current_y_velocity=parseFloat(document.getElementById("ion_y_velocity").value)}),document.getElementById("fdm_threshold").addEventListener("change",t=>{e.update_fdm_threshold(parseFloat(document.getElementById("fdm_threshold").value))}),document.getElementById("pressure").addEventListener("input",t=>{E.pressure=parseFloat(document.getElementById("pressure").value),e.update_pressure(E.pressure)}),document.getElementById("bg_gas").addEventListener("change",t=>{E.background_gas_mass=parseFloat(document.getElementById("bg_gas").value),console.log(E.background_gas_mass),e.update_gas_mass(E.background_gas_mass)}),document.getElementById("sin_frequency").addEventListener("input",e=>{E.electrode_frequencies[E.active_electrode]=parseFloat(document.getElementById("sin_frequency").value)}),document.getElementById("offset").addEventListener("input",t=>{E.electrode_offsets[E.active_electrode]=parseFloat(document.getElementById("offset").value),e.update_offsets(E.electrode_offsets)}),document.getElementById("pulse_start").addEventListener("input",e=>{E.pulse_starts[E.active_electrode]=parseFloat(document.getElementById("pulse_start").value)}),document.getElementById("pulse_end").addEventListener("input",e=>{E.pulse_ends[E.active_electrode]=parseFloat(document.getElementById("pulse_end").value)})}function F(e,t,l,n,o,d,c,i,a){let s=E.map_width/2,r=E.map_height/2;for(let l=0;l<s;l++)for(let n=0;n<r;n++){let o=t[l+s*n];e.brush(l,n,o)}E.emap_altered=!0;for(let e=0;e<l.length;e++)E.electrode_volts[e]=l[e],E.splattable[e]=n[e];for(let e=0;e<o.length;e++)E.electrode_frequencies[e]=o[e],E.dc_only[e]=d[e],E.electrode_offsets[e]=i[e],E.magnet_mode[e]=a[e];e.update_pressure(c),e.update_gas_mass(28),e.update_offsets(i),e.update_magnets(E.magnet_mode),document.getElementById("pressure").value=c,document.getElementById("bg_gas").getElementsByTagName("option")[0].selected="selected",C(),S(e)}const q=document.getElementById("electrode_map"),O=document.getElementById("electric_field_map");function T(e){E.dragging||1==E.brush||(E.to_apply=[]);for(let e=1;e<5;e++)document.getElementById("electrode"+e).innerHTML=`${E.electrode_volts[e]} ${E.magnet_mode[e]?"T":"V"}`;document.getElementById("set_voltage").innerHTML=E.magnet_mode[E.active_electrode]?"Set Teslas":"Set Volts",E.mouse_on_electrode_map&&function(e){if(!E.dragging){const t=e.scale(),l=E.cellSize*t,o=q.getBoundingClientRect();let d=E.mouse_electrode_map_x-o.left,c=E.mouse_electrode_map_y-o.top;if(d=Math.floor(d/(2*E.cellSize)),c=Math.floor(c/(2*E.cellSize)),E.previous_mouse_electrode_position_x2!=d||E.previous_mouse_electrode_position_y2!=c){B(e),E.previous_mouse_electrode_position_x2=d,E.previous_mouse_electrode_position_y2=c;const t=q.getContext("2d");if(t.fillStyle=n[E.active_electrode],1==E.brush||5==E.brush)t.fillRect(d*l,c*l,1*l,1*l);else if(2==E.brush)if(-1==E.initial_click[0]&&-1==E.initial_click[1])t.fillRect(d*l,c*l,l,l);else{let e=I(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),d,c);for(let n of e)t.fillRect(n[0]*l,n[1]*l,l,l)}else if(3==E.brush)if(-1==E.initial_click[0]&&-1==E.initial_click[1])t.fillRect(d*l,c*l,l,l);else{let e=k(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),d,c);for(let n of e)t.fillRect(n[0]*l,n[1]*l,l,l)}else if(4==E.brush)if(-1==E.initial_click[0]&&-1==E.initial_click[1])t.fillRect(d*l,c*l,l,l);else{let e=x(Math.floor(E.initial_click[0]/(2*E.cellSize)),Math.floor(E.initial_click[1]/(2*E.cellSize)),d,c);for(let n of e)t.fillRect(n[0]*l,n[1]*l,l,l)}}}}(e),E.emap_altered&&(E.emap_altered=!1,B(e)),E.voltages_were_updated&&(M(e),E.voltages_were_updated=!1)}!async function(){document.getElementById("dummyplayground").style.display="inline-block";const e=await l.e(1).then(l.bind(null,4)).catch(console.error),t=new e.Environment(E.map_width,E.map_height,E.scale,E.max_time,E.electrode_volts,E.splattable,E.pressure,E.background_gas_mass),o=e.lens(),d=e.tof(),c=e.quad(),i=e.cyclotron(),a=e.funnel();var s,r,u;window.screen.height*window.devicePixelRatio<1070&&(E.cellSize=2,E.canvas_height=400,E.canvas_width=400,O.width="400",O.height="400",q.width="400",q.height="400",document.getElementById("status").style.bottom="-445px",document.getElementById("status").style.left="-380px",document.getElementById("splatlog").style.width="280px"),function(e){O.addEventListener("click",t=>{const l=O.getBoundingClientRect();E.current_x_position=(t.clientX-l.left)/E.cellSize,E.current_y_position=(t.clientY-l.top)/E.cellSize,document.getElementById("x-position").value=E.current_x_position,document.getElementById("y-position").value=E.map_height-E.current_y_position,z(e,E.current_x_position,E.current_y_position)}),O.addEventListener("mousemove",t=>{const l=O.getBoundingClientRect();let n=t.clientX-l.left,o=t.clientY-l.top;if(n=Math.floor(n/E.cellSize),o=Math.floor(o/E.cellSize),n>=0&&o>=0){let t=e.getef(n,o);n=(""+n).padStart(3," "),o=(""+(e.height()-o-1)).padStart(3," "),t=(""+t.toFixed(2)).padStart(5," "),document.getElementById("status").innerHTML=`x: ${n} y: ${o}\nvolts: ${t}`}})}(t),function(e){q.addEventListener("mousedown",e=>{E.emap_altered=!0,E.dragging=!0}),q.addEventListener("mouseup",t=>{if(E.emap_altered=!0,E.dragging=!1,1==E.brush){const t=q.getBoundingClientRect();for(let l of E.to_apply){let n=l[0]-t.left,o=l[1]-t.top;n=Math.round(n/(2*E.cellSize)),o=Math.round(o/(2*E.cellSize)),e.brush(n,o,E.active_electrode)}E.to_apply=[]}}),q.addEventListener("click",t=>{if(1==E.brush||5==E.brush)w(t,e);else if(-1==E.initial_click[0]&&-1==E.initial_click[1]){const e=q.getBoundingClientRect();E.initial_click[0]=t.clientX-e.left,E.initial_click[1]=t.clientY-e.top}else w(t,e),E.initial_click[0]=-1,E.initial_click[1]=-1}),q.addEventListener("mousemove",t=>{const l=q.getBoundingClientRect(),o=E.cellSize*E.scale;E.rect=[l.left,l.top];let d=Math.floor((t.clientX-l.left)/E.cellSize),c=e.height()-Math.floor((t.clientY-l.top)/E.cellSize)-1;if(document.getElementById("status").innerHTML=`x: ${d} y: ${c}`,E.mouse_electrode_map_x=t.clientX,E.mouse_electrode_map_y=t.clientY,w(t,e),E.dragging&&1==E.brush){const e=q.getContext("2d");e.fillStyle=n[E.active_electrode];for(let t of E.to_apply){let n=t[0]-l.left,d=t[1]-l.top;n=Math.round(n/(2*E.cellSize)),d=Math.round(d/(2*E.cellSize)),e.fillRect(n*o,d*o,o,o)}}}),q.addEventListener("mouseover",e=>{E.mouse_on_electrode_map=!0}),q.addEventListener("mouseout",t=>{if(E.mouse_on_electrode_map=!1,E.dragging=!1,E.initial_click=[-1,-1],1==E.brush){const t=q.getBoundingClientRect();for(let l of E.to_apply){let n=l[0]-t.left,o=l[1]-t.top;n=Math.round(n/(2*E.cellSize)),o=Math.round(o/(2*E.cellSize)),e.brush(n,o,E.active_electrode)}E.to_apply=[]}B(e)})}(t),R(t,o,d,c,i,a),function(){var e=document.getElementsByClassName("collapsible");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(){this.classList.toggle("active");var e=this.nextElementSibling;"block"==e.style.display?e.style.display="none":e.style.display="block"})),e[t].nextElementSibling.style.display="none";document.getElementById("playground").click(),document.getElementById("playground").click();let t=document.getElementById("playground"),l=document.getElementById("playgrounddiv");t.addEventListener("click",e=>{console.log(l.style.backgroundColor),"rgb(243, 243, 243)"==l.style.backgroundColor?(l.style.backgroundColor="",l.style.boxShadow=""):(l.style.backgroundColor="rgb(243, 243, 243)",l.style.boxShadow="0 2px 3px 0 #00000033, 0 2px 4px 0 #00000030")}),document.getElementById("advanced").click(),document.getElementById("advanced").click(),document.getElementById("sin_frequency").disabled=!0,document.getElementById("offset").disabled=!0}(),B(t),M(t),function(){let e=location.pathname.split("/"),t=e[e.length-1];if(""!==t){let e=document.querySelectorAll(".topnav a");for(let l=0,n=e.length;l<n;l++)0==e[l].getAttribute("href").indexOf(t)&&(e[l].className+="current_page")}}(),s=document.getElementById("topnav"),r=document.getElementById("playgrounddiv"),u=r.offsetTop+s.offsetHeight,window.onscroll=()=>{window.pageYOffset>u?r.classList.add("sticky"):r.classList.remove("sticky")},document.getElementById("dummyplayground").style.display="none",document.getElementById("playgrounddiv").style.display="inline-block",setInterval(T.bind(null,t,q),60)}()}]);